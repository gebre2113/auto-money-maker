name: Profit Master Supreme v15.1 - Advanced Automation

on:
  # Schedule triggers
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours (optimized for API limits)
    - cron: '0 12 * * *'   # Daily at 12:00 UTC
    - cron: '0 0 1 * *'    # Monthly at 00:00 UTC
  
  # Manual triggers
  workflow_dispatch:
    inputs:
      operation_type:
        description: 'Operation Mode'
        required: true
        default: 'full-cycle'
        type: choice
        options:
          - full-cycle
          - content-generation
          - affiliate-monetization
          - multimedia-creation
          - social-media
          - maintenance
      content_topic:
        description: 'Content Topic (optional)'
        required: false
        default: 'AI Technology'
        type: string
      language:
        description: 'Content Language'
        required: false
        default: 'en'
        type: choice
        options:
          - en
          - am
          - es
          - fr
          - de
  
  # Repository events
  push:
    branches: [ main, master ]
    paths:
      - '**.py'
      - 'requirements.txt'
      - '.github/workflows/**'
  pull_request:
    branches: [ main, master ]

permissions:
  contents: write
  pages: write
  id-token: write
  actions: write
  checks: write

env:
  PYTHON_VERSION: '3.10'
  DATABASE_FILE: 'profit_master.db'
  OUTPUT_DIR: 'public'
  LOGS_DIR: 'logs'
  REPORTS_DIR: 'reports'
  CACHE_DIR: '.cache'
  
  # AI Configuration
  AI_MODEL: 'groq:llama-3.3-70b-versatile'
  MAX_CONTENT_LENGTH: '3000'
  QUALITY_THRESHOLD: '85'
  
  # Performance
  TIMEOUT_MINUTES: '180'
  MAX_RETRIES: '3'
  PARALLEL_JOBS: '2'

jobs:
  # ==================== JOB 1: SYSTEM INITIALIZATION ====================
  initialize_system:
    runs-on: ubuntu-latest
    name: "‚öôÔ∏è System Initialization"
    outputs:
      session_id: ${{ steps.generate_session.outputs.session_id }}
      run_timestamp: ${{ steps.generate_session.outputs.run_timestamp }}
      operation_mode: ${{ github.event.inputs.operation_type || 'full-cycle' }}
    
    steps:
      - name: "üîÑ Checkout Repository"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: "üì¶ Cache Dependencies"
        uses: actions/cache@v3
        with:
          path: |
            ~/.cache/pip
            ${{ env.CACHE_DIR }}
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
            
      - name: "üîß Generate Session ID"
        id: generate_session
        run: |
          SESSION_ID="PM_$(date +%Y%m%d_%H%M%S)_${GITHUB_RUN_ID}"
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          echo "session_id=${SESSION_ID}" >> $GITHUB_OUTPUT
          echo "run_timestamp=${TIMESTAMP}" >> $GITHUB_OUTPUT
          echo "SESSION_ID=${SESSION_ID}" >> $GITHUB_ENV
          echo "TIMESTAMP=${TIMESTAMP}" >> $GITHUB_ENV
          
      - name: "üìÅ Create Directory Structure"
        run: |
          mkdir -p data logs reports public/{articles,videos,audio,images,tables}
          mkdir -p .cache/{ai,downloads,temp}
          echo "Directory structure created"
          
      - name: "üóÑÔ∏è Initialize Database"
        run: |
          python3 << 'EOF'
          import sqlite3, os, json
          from datetime import datetime
          
          os.makedirs('data', exist_ok=True)
          conn = sqlite3.connect('data/profit_master.db')
          cursor = conn.cursor()
          
          # System logs table
          cursor.execute('''
          CREATE TABLE IF NOT EXISTS system_logs (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              session_id TEXT,
              operation TEXT,
              status TEXT,
              details TEXT,
              created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
          )
          ''')
          
          # Content table
          cursor.execute('''
          CREATE TABLE IF NOT EXISTS content (
              id TEXT PRIMARY KEY,
              title TEXT,
              topic TEXT,
              language TEXT,
              word_count INTEGER,
              quality_score REAL,
              monetized BOOLEAN,
              created_at TIMESTAMP,
              metadata TEXT
          )
          ''')
          
          # Performance metrics table
          cursor.execute('''
          CREATE TABLE IF NOT EXISTS performance (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              session_id TEXT,
              metric_name TEXT,
              metric_value REAL,
              timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
          )
          ''')
          
          # Log initial entry
          cursor.execute('''
          INSERT INTO system_logs (session_id, operation, status, details)
          VALUES (?, ?, ?, ?)
          ''', (os.getenv('SESSION_ID'), 'init', 'success', 'Database initialized'))
          
          conn.commit()
          conn.close()
          print("‚úÖ Database initialized with 3 tables")
          EOF
          
      - name: "üì§ Upload Initial State"
        uses: actions/upload-artifact@v4
        with:
          name: system-initial-state
          path: |
            data/
            logs/
          retention-days: 7

  # ==================== JOB 2: DEPENDENCY SETUP ====================
  setup_dependencies:
    needs: initialize_system
    runs-on: ubuntu-latest
    name: "üì¶ Dependency Setup"
    
    steps:
      - name: "üîÑ Checkout Code"
        uses: actions/checkout@v4
        
      - name: "üì• Download Initial State"
        uses: actions/download-artifact@v4
        with:
          name: system-initial-state
          path: ./
          
      - name: "üêç Setup Python"
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
          
      - name: "üîß Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            ffmpeg \
            imagemagick \
            libmagic-dev \
            libpq-dev \
            redis-server \
            postgresql-client \
            curl \
            wget \
            git \
            unzip
          echo "System dependencies installed"
          
      - name: "üìú Create Requirements File"
        run: |
          cat > requirements.txt << 'EOF'
          # Core dependencies
          aiohttp>=3.9.0
          httpx>=0.25.0
          pandas>=2.0.0
          numpy>=1.24.0
          requests>=2.31.0
          schedule>=1.2.0
          plotly>=5.18.0
          
          # AI/ML dependencies
          groq>=0.3.0
          google-generativeai>=0.3.0
          openai>=0.28.0
          anthropic>=0.7.0
          cohere>=4.0.0
          transformers>=4.35.0
          torch>=2.1.0
          torchvision>=0.16.0
          torchaudio>=2.1.0
          
          # Content generation
          gtts>=2.3.0
          moviepy>=1.0.3
          pytube>=15.0.0
          yt-dlp>=2023.10.13
          Pillow>=10.0.0
          python-docx>=0.8.11
          reportlab>=4.0.0
          
          # Web & scraping
          beautifulsoup4>=4.12.0
          lxml>=4.9.0
          selenium>=4.15.0
          scrapy>=2.11.0
          
          # Social media automation
          tweepy>=4.14.0
          facebook-sdk>=4.0.0
          python-telegram-bot>=20.0
          discord-webhook>=1.0.0
          instagrapi>=2.0.0
          linkedin-api>=2.0.0
          
          # Database & storage
          sqlalchemy>=2.0.0
          redis>=5.0.0
          pymongo>=4.5.0
          psycopg2-binary>=2.9.0
          boto3>=1.34.0
          
          # NLP & text processing
          nltk>=3.8.0
          spacy>=3.7.0
          textblob>=0.17.1
          langdetect>=1.0.9
          googletrans==3.1.0a0
          sumy>=0.11.0
          
          # Web framework & API
          fastapi>=0.104.0
          uvicorn>=0.24.0
          pydantic>=2.4.0
          streamlit>=1.28.0
          streamlit-option-menu>=0.3.0
          
          # Utilities
          prometheus-client>=0.19.0
          python-dotenv>=1.0.0
          colorama>=0.4.6
          tqdm>=4.66.0
          loguru>=0.7.2
          python-multipart>=0.0.6
          
          # Development
          pytest>=7.4.0
          black>=23.0.0
          flake8>=6.1.0
          mypy>=1.7.0
          pre-commit>=3.5.0
          EOF
          
      - name: "üì¶ Install Python Dependencies"
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
          
          # Install spaCy model
          python -m spacy download en_core_web_sm
          
          # Download NLTK data
          python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger
          
      - name: "üîç Verify Installations"
        run: |
          python3 -c "
          import sys
          print(f'Python version: {sys.version}')
          
          packages = ['groq', 'google.generativeai', 'openai', 'anthropic', 'cohere', 
                     'transformers', 'torch', 'pandas', 'numpy', 'fastapi', 'sqlalchemy']
          
          for pkg in packages:
              try:
                  __import__(pkg.replace('-', '_').replace('.', '_'))
                  print(f'‚úÖ {pkg} installed')
              except ImportError as e:
                  print(f'‚ùå {pkg} not installed: {e}')
          "
          
      - name: "üì§ Cache Dependencies"
        uses: actions/upload-artifact@v4
        with:
          name: python-dependencies
          path: |
            ~/.cache/pip/
            ${{ env.CACHE_DIR }}/
          retention-days: 30

  # ==================== JOB 3: CORE OPERATIONS ====================
  core_operations:
    needs: [initialize_system, setup_dependencies]
  timeout-minutes: 180  # ·âÄ·å•·â≥ 180 ·ã∞·âÇ·âÉ
    
    strategy:
      matrix:
        operation: ['content', 'multimedia', 'monetization']
      fail-fast: false
      max-parallel: 2     # ·âÄ·å•·â≥ ·âÅ·å•·à≠ 2
    
    steps:
      - name: "üîÑ Checkout Code"
        uses: actions/checkout@v4
        
      - name: "üì• Download Dependencies Cache"
        uses: actions/download-artifact@v4
        with:
          name: python-dependencies
          path: ${{ env.CACHE_DIR }}
          
      - name: "üì• Download System State"
        uses: actions/download-artifact@v4
        with:
          name: system-initial-state
          path: ./
          
      - name: "üîß Setup Environment"
        env:
          SESSION_ID: ${{ needs.initialize_system.outputs.session_id }}
          OPERATION_MODE: ${{ needs.initialize_system.outputs.operation_mode }}
          CONTENT_TOPIC: ${{ github.event.inputs.content_topic || 'AI Technology Trends' }}
          LANGUAGE: ${{ github.event.inputs.language || 'en' }}
        run: |
          echo "SESSION_ID=$SESSION_ID" >> $GITHUB_ENV
          echo "OPERATION_MODE=$OPERATION_MODE" >> $GITHUB_ENV
          echo "CONTENT_TOPIC=$CONTENT_TOPIC" >> $GITHUB_ENV
          echo "LANGUAGE=$LANGUAGE" >> $GITHUB_ENV
          
      - name: "üöÄ Execute ${{ matrix.operation }} Module"
        env:
          # AI API Keys
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          COHERE_API_KEY: ${{ secrets.COHERE_API_KEY }}
          HUGGINGFACE_TOKEN: ${{ secrets.HUGGINGFACE_TOKEN }}
          
          # Social Media API Keys
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
          
          FACEBOOK_ACCESS_TOKEN: ${{ secrets.FACEBOOK_ACCESS_TOKEN }}
          FACEBOOK_PAGE_ID: ${{ secrets.FACEBOOK_PAGE_ID }}
          
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          
          # YouTube API
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
          
          # Database Configuration
          DATABASE_URL: "sqlite:///data/profit_master.db"
          REDIS_URL: "redis://localhost:6379/0"
          
          # AWS (for S3 storage)
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION || 'us-east-1' }}
          
          # Other configurations
          MAX_CONTENT_LENGTH: ${{ env.MAX_CONTENT_LENGTH }}
          QUALITY_THRESHOLD: ${{ env.QUALITY_THRESHOLD }}
          LOG_LEVEL: "INFO"
          
        run: |
          echo "Starting ${{ matrix.operation }} module for session: $SESSION_ID"
          
          # Create main execution script
          cat > run_${{ matrix.operation }}.py << 'EOF'
          import os, sys, json, time, asyncio, logging
          from datetime import datetime
          import sqlite3
          
          # Configure logging
          logging.basicConfig(
              level=os.getenv('LOG_LEVEL', 'INFO'),
              format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
              handlers=[
                  logging.FileHandler(f'logs/{os.getenv("SESSION_ID")}_{os.getenv("OPERATION_MODE")}.log'),
                  logging.StreamHandler()
              ]
          )
          
          logger = logging.getLogger(__name__)
          
          async def run_content_module():
              """Content generation module"""
              logger.info("Starting content generation module")
              
              # Simulate content creation
              content_data = {
                  "id": f"content_{int(time.time())}",
                  "title": f"Ultimate Guide to {os.getenv('CONTENT_TOPIC')}",
                  "topic": os.getenv('CONTENT_TOPIC'),
                  "language": os.getenv('LANGUAGE'),
                  "word_count": 2500,
                  "quality_score": 92.5,
                  "monetized": True,
                  "created_at": datetime.now().isoformat(),
                  "metadata": {
                      "ai_model": os.getenv('AI_MODEL'),
                      "session_id": os.getenv('SESSION_ID'),
                      "operation_mode": os.getenv('OPERATION_MODE')
                  }
              }
              
              # Save to database
              conn = sqlite3.connect('data/profit_master.db')
              cursor = conn.cursor()
              cursor.execute('''
                  INSERT OR REPLACE INTO content 
                  (id, title, topic, language, word_count, quality_score, monetized, created_at, metadata)
                  VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
              ''', (
                  content_data['id'],
                  content_data['title'],
                  content_data['topic'],
                  content_data['language'],
                  content_data['word_count'],
                  content_data['quality_score'],
                  content_data['monetized'],
                  content_data['created_at'],
                  json.dumps(content_data['metadata'])
              ))
              conn.commit()
              
              # Save to file
              os.makedirs('public/articles', exist_ok=True)
              with open(f'public/articles/{content_data["id"]}.json', 'w') as f:
                  json.dump(content_data, f, indent=2)
              
              # Generate HTML article
              html_content = f'''
              <!DOCTYPE html>
              <html lang="{content_data['language']}">
              <head>
                  <meta charset="UTF-8">
                  <meta name="viewport" content="width=device-width, initial-scale=1.0">
                  <title>{content_data['title']}</title>
                  <style>
                      body {{ font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; }}
                      h1 {{ color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }}
                      .meta {{ color: #666; font-size: 0.9em; margin-bottom: 30px; }}
                      .content {{ margin-top: 20px; }}
                      .affiliate {{ background: #f9f9f9; padding: 15px; border-left: 4px solid #4CAF50; margin: 20px 0; }}
                  </style>
              </head>
              <body>
                  <h1>{content_data['title']}</h1>
                  <div class="meta">
                      Generated: {content_data['created_at']} | 
                      Words: {content_data['word_count']} | 
                      Quality: {content_data['quality_score']}%
                  </div>
                  <div class="content">
                      <p>This is AI-generated content about {content_data['topic']}. 
                      It has been optimized for SEO and affiliate monetization.</p>
                      
                      <div class="affiliate">
                          <h3>üí° Recommended Tools:</h3>
                          <ul>
                              <li><a href="https://www.bluehost.com/track/profitmaster/" target="_blank">Bluehost Web Hosting</a></li>
                              <li><a href="https://www.nordvpn.com/ref/profitmastervip/" target="_blank">NordVPN Security</a></li>
                              <li><a href="https://jasper.ai?fpr=profitmaster12" target="_blank">Jasper AI Writing Assistant</a></li>
                          </ul>
                      </div>
                      
                      <p>This content is automatically generated and updated regularly.</p>
                  </div>
              </body>
              </html>
              '''
              
              with open(f'public/articles/{content_data["id"]}.html', 'w') as f:
                  f.write(html_content)
              
              logger.info(f"Content generated: {content_data['id']}")
              return content_data
          
          async def run_multimedia_module():
              """Multimedia creation module"""
              logger.info("Starting multimedia creation module")
              
              # Simulate multimedia creation
              multimedia_data = {
                  "id": f"media_{int(time.time())}",
                  "type": "video_summary",
                  "duration": "3:45",
                  "format": "mp4",
                  "resolution": "1080p",
                  "created_at": datetime.now().isoformat()
              }
              
              # Create placeholder files
              os.makedirs('public/videos', exist_ok=True)
              os.makedirs('public/audio', exist_ok=True)
              
              with open(f'public/videos/{multimedia_data["id"]}.txt', 'w') as f:
                  f.write(f"Video transcript for {os.getenv('CONTENT_TOPIC')}")
              
              logger.info(f"Multimedia created: {multimedia_data['id']}")
              return multimedia_data
          
          async def run_monetization_module():
              """Affiliate monetization module"""
              logger.info("Starting affiliate monetization module")
              
              # Simulate affiliate link generation
              affiliate_data = {
                  "id": f"affiliate_{int(time.time())}",
                  "products": [
                      {
                          "name": "Bluehost Pro",
                          "category": "hosting",
                          "commission": 75.0,
                          "link": "https://www.bluehost.com/track/profitmaster/"
                      },
                      {
                          "name": "NordVPN Ultimate",
                          "category": "security",
                          "commission": 45.0,
                          "link": "https://nordvpn.com/ref/profitmastervip/"
                      },
                      {
                          "name": "Jasper AI Pro",
                          "category": "ai_tools",
                          "commission": 25.0,
                          "link": "https://jasper.ai?fpr=profitmaster12"
                      }
                  ],
                  "estimated_revenue": 145.0,
                  "created_at": datetime.now().isoformat()
              }
              
              # Save affiliate links
              os.makedirs('public/affiliate', exist_ok=True)
              with open(f'public/affiliate/{affiliate_data["id"]}.json', 'w') as f:
                  json.dump(affiliate_data, f, indent=2)
              
              logger.info(f"Affiliate links generated: {affiliate_data['id']}")
              return affiliate_data
          
          async def main():
              operation_type = os.getenv('OPERATION_MODE', 'full-cycle')
              matrix_operation = os.getenv('GITHUB_JOB', '').split('_')[-1]
              
              logger.info(f"Operation: {operation_type}, Matrix: {matrix_operation}")
              
              results = {}
              
              if matrix_operation == 'content' or operation_type in ['full-cycle', 'content-generation']:
                  results['content'] = await run_content_module()
              
              if matrix_operation == 'multimedia' or operation_type in ['full-cycle', 'multimedia-creation']:
                  results['multimedia'] = await run_multimedia_module()
              
              if matrix_operation == 'monetization' or operation_type in ['full-cycle', 'affiliate-monetization']:
                  results['monetization'] = await run_monetization_module()
              
              # Log performance
              conn = sqlite3.connect('data/profit_master.db')
              cursor = conn.cursor()
              
              for module, data in results.items():
                  cursor.execute('''
                      INSERT INTO performance (session_id, metric_name, metric_value)
                      VALUES (?, ?, ?)
                  ''', (os.getenv('SESSION_ID'), f'{module}_generated', 1))
              
              cursor.execute('''
                  INSERT INTO system_logs (session_id, operation, status, details)
                  VALUES (?, ?, ?, ?)
              ''', (os.getenv('SESSION_ID'), matrix_operation, 'completed', json.dumps(results)))
              
              conn.commit()
              conn.close()
              
              logger.info(f"Completed {matrix_operation} module")
              print(json.dumps({"status": "success", "results": results}, indent=2))
          
          if __name__ == "__main__":
              asyncio.run(main())
          EOF
          
          # Execute the module
          python3 run_${{ matrix.operation }}.py
          
      - name: "üìä Generate Performance Report"
        run: |
          python3 << 'EOF'
          import sqlite3, json, os
          from datetime import datetime
          
          conn = sqlite3.connect('data/profit_master.db')
          cursor = conn.cursor()
          
          # Get session statistics
          cursor.execute('''
              SELECT 
                  COUNT(DISTINCT id) as content_count,
                  AVG(quality_score) as avg_quality,
                  COUNT(CASE WHEN monetized THEN 1 END) as monetized_count
              FROM content
              WHERE created_at >= datetime('now', '-1 day')
          ''')
          
          stats = cursor.fetchone()
          
          report = {
              "session_id": os.getenv('SESSION_ID'),
              "timestamp": datetime.now().isoformat(),
              "operation_mode": os.getenv('OPERATION_MODE'),
              "statistics": {
                  "content_generated": stats[0] or 0,
                  "average_quality": round(stats[1] or 0, 2),
                  "monetized_content": stats[2] or 0
              },
              "performance_metrics": []
          }
          
          cursor.execute('''
              SELECT metric_name, COUNT(*) as count
              FROM performance
              WHERE session_id = ?
              GROUP BY metric_name
          ''', (os.getenv('SESSION_ID'),))
          
          for row in cursor.fetchall():
              report["performance_metrics"].append({
                  "metric": row[0],
                  "count": row[1]
              })
          
          conn.close()
          
          os.makedirs('reports', exist_ok=True)
          with open(f'reports/performance_{os.getenv("SESSION_ID")}.json', 'w') as f:
              json.dump(report, f, indent=2)
          
          print("Performance report generated")
          EOF
          
      - name: "üì§ Upload Results"
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.operation }}-results-${{ env.SESSION_ID }}
          path: |
            public/
            logs/
            reports/
            data/profit_master.db
          retention-days: 30

  # ==================== JOB 4: SOCIAL MEDIA DISTRIBUTION ====================
  social_media_distribution:
    needs: core_operations
    runs-on: ubuntu-latest
    name: "üì± Social Media Distribution"
    if: github.event.inputs.operation_type == 'full-cycle' || github.event.inputs.operation_type == 'social-media'
    
    steps:
      - name: "üì• Download Content Results"
        uses: actions/download-artifact@v4
        with:
          name: content-results-${{ needs.initialize_system.outputs.session_id }}
          path: ./
          
      - name: "üì± Post to Social Media"
        env:
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
          
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          
          SESSION_ID: ${{ needs.initialize_system.outputs.session_id }}
        run: |
          python3 << 'EOF'
          import os, json, requests, logging
          from datetime import datetime
          
          logging.basicConfig(level=logging.INFO)
          logger = logging.getLogger(__name__)
          
          session_id = os.getenv('SESSION_ID')
          
          # Find latest content
          articles_dir = 'public/articles'
          if os.path.exists(articles_dir):
              articles = [f for f in os.listdir(articles_dir) if f.endswith('.json')]
              if articles:
                  latest = max(articles)
                  with open(os.path.join(articles_dir, latest), 'r') as f:
                      content = json.load(f)
                  
                  # Create social media posts
                  posts = {
                      "twitter": f"üöÄ New Article: {content['title']}\n\nRead: https://your-domain.com/articles/{content['id']}.html\n\n#AI #Content #Automation",
                      "telegram": f"üì¢ *New Content Alert*\n\n*{content['title']}*\n\nüîó Read here: https://your-domain.com/articles/{content['id']}.html\n\nGenerated by Profit Master Supreme v15.1",
                      "facebook": f"New AI-generated content available: {content['title']}\n\nQuality Score: {content['quality_score']}%\nWord Count: {content['word_count']}\n\nüëâ Read more: https://your-domain.com/articles/{content['id']}.html"
                  }
                  
                  # Save posts
                  os.makedirs('public/social', exist_ok=True)
                  with open(f'public/social/posts_{session_id}.json', 'w') as f:
                      json.dump(posts, f, indent=2)
                  
                  logger.info(f"Social media posts created for {content['id']}")
                  print("Social media posts prepared:")
                  for platform, post in posts.items():
                      print(f"\n{platform.upper()}:\n{post[:100]}...")
          
          # Simulate posting (in production, you would use actual API calls)
          print("\nüì± Social media distribution ready")
          print("Note: Actual posting requires API configuration")
          EOF
          
      - name: "üì§ Upload Social Media Content"
        uses: actions/upload-artifact@v4
        with:
          name: social-media-${{ needs.initialize_system.outputs.session_id }}
          path: public/social/

  # ==================== JOB 5: REPORTING & DASHBOARD ====================
  reporting_dashboard:
    needs: [core_operations, social_media_distribution]
    runs-on: ubuntu-latest
    name: "üìä Reporting & Dashboard"
    
    steps:
      - name: "üì• Download All Results"
        run: |
          # Download artifacts from all jobs
          mkdir -p artifacts
          cd artifacts
          
          # List all artifacts
          artifacts=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts" \
            | jq -r '.artifacts[].name')
          
          for artifact in $artifacts; do
            echo "Downloading: $artifact"
            gh run download ${{ github.run_id }} --name "$artifact" --dir "$artifact"
          done
          
      - name: "üìà Generate Comprehensive Dashboard"
        run: |
          python3 << 'EOF'
          import json, os, glob, sqlite3
          from datetime import datetime
          import pandas as pd
          
          # Collect all data
          all_data = {
              "system": {
                  "session_id": os.getenv('SESSION_ID', 'unknown'),
                  "timestamp": datetime.now().isoformat(),
                  "repository": "${{ github.repository }}",
                  "workflow": "${{ github.workflow }}",
                  "run_id": "${{ github.run_id }}"
              },
              "content": [],
              "performance": [],
              "reports": []
          }
          
          # Read database
          if os.path.exists('data/profit_master.db'):
              conn = sqlite3.connect('data/profit_master.db')
              cursor = conn.cursor()
              
              cursor.execute('SELECT * FROM content ORDER BY created_at DESC LIMIT 10')
              columns = [desc[0] for desc in cursor.description]
              for row in cursor.fetchall():
                  all_data["content"].append(dict(zip(columns, row)))
              
              cursor.execute('SELECT * FROM performance WHERE session_id = ?', 
                           (all_data["system"]["session_id"],))
              columns = [desc[0] for desc in cursor.description]
              for row in cursor.fetchall():
                  all_data["performance"].append(dict(zip(columns, row)))
              
              conn.close()
          
          # Read JSON reports
          for report_file in glob.glob('reports/*.json'):
              with open(report_file, 'r') as f:
                  all_data["reports"].append(json.load(f))
          
          # Generate HTML dashboard
          html = f'''
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Profit Master Supreme Dashboard</title>
              <style>
                  * {{ margin: 0; padding: 0; box-sizing: border-box; }}
                  body {{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; line-height: 1.6; }}
                  .container {{ max-width: 1400px; margin: 0 auto; padding: 20px; }}
                  header {{ background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 40px; margin-bottom: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); text-align: center; }}
                  h1 {{ color: #4a5568; font-size: 3em; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }}
                  .subtitle {{ color: #718096; font-size: 1.2em; margin-bottom: 30px; }}
                  .stats-grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; }}
                  .stat-card {{ background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); transition: transform 0.3s ease; }}
                  .stat-card:hover {{ transform: translateY(-5px); }}
                  .stat-value {{ font-size: 2.5em; font-weight: bold; color: #4a5568; margin: 10px 0; }}
                  .stat-label {{ color: #718096; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }}
                  .content-grid {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }}
                  .content-card {{ background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px; margin-bottom: 25px; }}
                  table {{ width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }}
                  th, td {{ padding: 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }}
                  th {{ background: #f7fafc; color: #4a5568; font-weight: 600; }}
                  tr:hover {{ background: #f7fafc; }}
                  .footer {{ text-align: center; padding: 30px; color: #a0aec0; font-size: 0.9em; margin-top: 50px; }}
                  .badge {{ display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 0.8em; font-weight: 600; margin: 0 5px; }}
                  .badge-success {{ background: #c6f6d5; color: #22543d; }}
                  .badge-warning {{ background: #feebc8; color: #744210; }}
                  .badge-info {{ background: #bee3f8; color: #2c5282; }}
                  .last-run {{ background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0; }}
              </style>
          </head>
          <body>
              <div class="container">
                  <header>
                      <h1>üöÄ Profit Master Supreme v15.1</h1>
                      <div class="subtitle">Advanced AI Content Generation & Monetization System</div>
                      <div class="last-run">
                          <strong>Session ID:</strong> {all_data["system"]["session_id"]}<br>
                          <strong>Last Run:</strong> {all_data["system"]["timestamp"]}<br>
                          <strong>Status:</strong> <span class="badge badge-success">ACTIVE</span>
                      </div>
                  </header>
                  
                  <div class="stats-grid">
                      <div class="stat-card">
                          <div class="stat-label">Content Generated</div>
                          <div class="stat-value">{len(all_data["content"])}</div>
                          <div class="stat-desc">AI-powered articles</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-label">Avg Quality Score</div>
                          <div class="stat-value">
                              {round(sum(c["quality_score"] for c in all_data["content"]) / len(all_data["content"]) if all_data["content"] else 0, 1)}%
                          </div>
                          <div class="stat-desc">Human-like content</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-label">Monetization Rate</div>
                          <div class="stat-value">
                              {round(sum(1 for c in all_data["content"] if c.get("monetized")) / len(all_data["content"]) * 100 if all_data["content"] else 0, 0)}%
                          </div>
                          <div class="stat-desc">Affiliate optimized</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-label">Performance Metrics</div>
                          <div class="stat-value">{len(all_data["performance"])}</div>
                          <div class="stat-desc">Tracked metrics</div>
                      </div>
                  </div>
                  
                  <h2 style="color: white; margin: 40px 0 20px 0;">üìù Latest Content</h2>
                  <div class="content-grid">
                      {''.join([f'''
                      <div class="content-card">
                          <h3>{c["title"]}</h3>
                          <p><strong>Topic:</strong> {c["topic"]}</p>
                          <p><strong>Language:</strong> {c["language"].upper()}</p>
                          <p><strong>Words:</strong> {c["word_count"]}</p>
                          <p><strong>Quality:</strong> <span class="badge {'badge-success' if c["quality_score"] > 85 else 'badge-warning'}">{c["quality_score"]}%</span></p>
                          <p><strong>Monetized:</strong> <span class="badge {'badge-success' if c["monetized"] else 'badge-info'}">{'Yes' if c["monetized"] else 'No'}</span></p>
                          <p><small>Created: {c["created_at"][:19].replace('T', ' ')}</small></p>
                      </div>
                      ''' for c in all_data["content"][:6]]) if all_data["content"] else '<p style="color: white; text-align: center;">No content generated yet</p>'}
                  </div>
                  
                  <h2 style="color: white; margin: 40px 0 20px 0;">üìä Performance Metrics</h2>
                  <table>
                      <thead>
                          <tr>
                              <th>Metric</th>
                              <th>Count</th>
                              <th>Session</th>
                              <th>Timestamp</th>
                          </tr>
                      </thead>
                      <tbody>
                          {''.join([f'''
                          <tr>
                              <td>{p["metric_name"]}</td>
                              <td><strong>{p["metric_value"]}</strong></td>
                              <td>{p["session_id"][:15]}...</td>
                              <td>{p["timestamp"][:19]}</td>
                          </tr>
                          ''' for p in all_data["performance"][:10]]) if all_data["performance"] else '<tr><td colspan="4" style="text-align: center;">No performance data yet</td></tr>'}
                      </tbody>
                  </table>
                  
                  <div class="footer">
                      <p>Generated automatically by Profit Master Supreme v15.1</p>
                      <p>Next scheduled run: In 6 hours | Repository: {all_data["system"]["repository"]}</p>
                      <p>¬© {datetime.now().year} - All rights reserved</p>
                  </div>
              </div>
          </body>
          </html>
          '''
          
          os.makedirs('public', exist_ok=True)
          with open('public/index.html', 'w') as f:
              f.write(html)
          
          print("Dashboard generated successfully")
          EOF
          
      - name: "üì§ Upload Dashboard"
        uses: actions/upload-artifact@v4
        with:
          name: dashboard-${{ needs.initialize_system.outputs.session_id }}
          path: public/

      - name: "üöÄ Deploy to GitHub Pages"
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          keep_files: true
          force_orphan: false
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'

  # ==================== JOB 6: CLEANUP & NOTIFICATION ====================
  cleanup_notification:
    needs: [reporting_dashboard]
    runs-on: ubuntu-latest
    name: "üßπ Cleanup & Notification"
    if: always()
    
    steps:
      - name: "üìä Generate Final Report"
        run: |
          python3 << 'EOF'
          import json, os
          from datetime import datetime
          
          final_report = {
              "workflow": "${{ github.workflow }}",
              "run_id": "${{ github.run_id }}",
              "session_id": "${{ needs.initialize_system.outputs.session_id }}",
              "status": "${{ job.status }}",
              "completed_at": datetime.now().isoformat(),
              "duration": "${{ github.event.workflow_run.run_duration || 'N/A' }}",
              "summary": {
                  "content_generated": "Check artifacts for details",
                  "quality_scores": "Available in dashboard",
                  "monetization": "Affiliate links generated",
                  "next_run": "In 6 hours"
              }
          }
          
          os.makedirs('reports', exist_ok=True)
          with open('reports/final_report.json', 'w') as f:
              json.dump(final_report, f, indent=2)
          
          print("Final report generated")
          print(json.dumps(final_report, indent=2))
          EOF
          
      - name: "üìß Send Notification"
        if: ${{ github.event_name == 'workflow_dispatch' }}
        run: |
          echo "Workflow completed successfully!"
          echo "Session ID: ${{ needs.initialize_system.outputs.session_id }}"
          echo "Dashboard: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
          echo "Content generated and ready for distribution."
          
      - name: "üßπ Cleanup Temporary Files"
        run: |
          rm -rf __pycache__ *.pyc .cache/temp
          echo "Temporary files cleaned up"
          
      - name: "üì§ Upload Final Artifacts"
        uses: actions/upload-artifact@v4
        with:
          name: final-artifacts-${{ needs.initialize_system.outputs.session_id }}
          path: |
            reports/
            logs/
          retention-days: 90
