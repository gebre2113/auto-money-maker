name: ðŸš€ Profit Master Elite - Production Auto-Pilot

on:
  # 1. á‰ á‹¨á‰€áŠ‘ áˆ›á‰³ 10:00 UTC (áˆ›áˆˆá‹³ 1:00 Ethiopia)
  schedule:
    - cron: '0 22 * * *'  # áŠ¨áˆ˜áŠá‰³ áŠ áˆáŒ‹ á‰ áŠá‰µ áŠ¥áŠ•á‹²áˆ°áˆ«
  
  # 2. á‰ áˆšáˆáˆáŒ‰á‰ á‰µ áŒŠá‹œ
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ'
        required: false
        default: 'Digital Marketing Strategy'
      country:
        description: 'á‰³áˆ­áŒ‹á‰µ áˆ€áŒˆáˆ­'
        required: false
        default: 'US'

  # 3. á‹ˆá‹° main áˆ²áŒˆá‰£ áˆˆáˆ›áˆµá‰°áŠ«áŠ¨áˆ
  push:
    branches: [main]
    paths:
      - 'profit_master_v17.py'
      - 'requirements.txt'

jobs:
  elite-content-factory:
    name: ðŸ­ Elite Content Factory
    runs-on: ubuntu-latest
    timeout-minutes: 30  # áŠ¨áˆ‹á‹­ áˆŠáŒ á‹ áŠ¥áŠ•á‹³á‹­á‰½áˆ
    
    # á‹¨áˆšáˆµáŒ¥áˆ­ á‰áˆáŽá‰½ áŠ¨GitHub Secrets áˆ›áˆµá‰°áˆ‹áˆˆá
    env:
      GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      DATABASE_URL: sqlite:///profit_master.db
      REDIS_URL: redis://localhost:6379/0
    
    steps:
    - name: ðŸ“¥ áŠ®á‹µ áˆ›á‹áˆ¨á‹µ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: ðŸ Python áˆ›á‹‹á‰€áˆ­
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: ðŸ“¦ áŒ¥áŒˆáŠ› áˆ˜áŒ«áŠ•
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        # á‰°áŒ¨áˆ›áˆª á‹¨áˆµáˆ­á‹“á‰µ áŒ¥áŒˆáŠ›á‹Žá‰½
        pip install python-dotenv redis hiredis
    
    - name: ðŸ”§ áˆšáˆµáŒ¥áˆ®á‰½ áˆ›á‹˜áŒ‹áŒ€á‰µ
      run: |
        # áˆˆáŠ áŠ«á‰£á‰¢ áˆ™áŠ¨áˆ« á‹¨áˆšáˆµáŒ¥áˆ­ á‹á‹­áˆ áˆ˜ááŒ áˆ­
        echo "GROQ_API_KEY=$GROQ_API_KEY" > .env
        echo "GEMINI_API_KEY=$GEMINI_API_KEY" >> .env
        echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env
        echo "DATABASE_URL=$DATABASE_URL" >> .env
    
    - name: ðŸ§ª áˆ™áŠ¨áˆ« áˆ›áˆµáŠ¬á‹µ
      run: |
        # á‹¨áˆµáˆ­á‹“á‰±áŠ• á‹¨áˆ˜áŒ€áˆ˜áˆªá‹« áˆ™áŠ¨áˆ«
        python -c "
        try:
            from profit_master_v17 import PremiumConfig
            config = PremiumConfig()
            print('âœ… PremiumConfig: PASS')
            services = config.get_ai_service_priority()
            print(f'âœ… AI Services: {len(services)} found')
        except Exception as e:
            print(f'âŒ Test failed: {e}')
            exit(1)
        "
    
    - name: ðŸš€ á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ¨á‰µ
      run: |
        # á‹¨áŠ á‹á‰¶áˆ›á‰²áŠ­ áˆµáŠ­áˆªá•á‰µ áˆ˜ááŒ áˆ­
        cat > generate_content.py << 'EOF'
        import asyncio
        import json
        import os
        import sys
        
        # á‹¨áˆ­á‹•áˆµ áŠ¥áŠ“ áˆ€áŒˆáˆ­ áˆ›áˆµá‰°áˆ‹áˆˆá
        topic = os.getenv('INPUT_TOPIC', 'Future of AI in Business')
        country = os.getenv('INPUT_COUNTRY', 'US')
        
        async def main():
            try:
                from profit_master_v17 import ProfitMasterEliteSystem, PremiumConfig
                
                print(f"ðŸš€ Starting generation for: {topic} [{country}]")
                
                config = PremiumConfig()
                system = ProfitMasterEliteSystem(config)
                
                # Generate content
                result = await system.create_elite_content_package(
                    topic=topic,
                    country=country,
                    language='en'
                )
                
                # Save result
                output_file = f"elite_output_{country}_{int(time.time())}.json"
                with open(output_file, 'w', encoding='utf-8') as f:
                    json.dump(result, f, indent=2, ensure_ascii=False)
                
                print(f"âœ… Content generated: {output_file}")
                print(f"ðŸ“Š Estimated value: ${result.get('estimated_values', {}).get('total_package_value', 0):,.2f}")
                
                return result
                
            except Exception as e:
                print(f"âŒ Generation failed: {e}")
                import traceback
                traceback.print_exc()
                return None
        
        if __name__ == "__main__":
            import time
            asyncio.run(main())
        EOF
        
        # áˆµáŠ­áˆªá•á‰±áŠ• áˆ›áˆµáŠ¬á‹µ
        python generate_content.py
    
    - name: ðŸ’¾ á‹áŒ¤á‰¶á‰½áŠ• áˆ›áˆµá‰€áˆ˜áŒ¥
      uses: actions/upload-artifact@v4
      with:
        name: elite-content-${{ github.run_id }}
        path: |
          elite_output_*.json
          profit_master_v17.log
        retention-days: 7
    
    - name: ðŸ“Š áˆ›áŒ á‰ƒáˆˆá‹« áˆ›á‰°áˆ
      if: always()
      run: |
        echo "## ðŸ“ˆ Profit Master Elite Run Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Run ID:** ${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY
        echo "**Topic:** ${{ github.event.inputs.topic || 'AI Business Strategies' }}" >> $GITHUB_STEP_SUMMARY
        echo "**Country:** ${{ github.event.inputs.country || 'US' }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Content generation pipeline completed" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“ Artifacts available for download" >> $GITHUB_STEP_SUMMARY
