name: Profit Master Supreme - EXECUTE

on:
  schedule:
    - cron: '0 */6 * * *'  # á‰ á‹¨ 6 áˆ°á‹“á‰± á‰ áˆ«áˆ± á‹­áˆ°áˆ«áˆ
  workflow_dispatch:       # áŠ áŠ•á‰° á‰ áˆáˆˆáŒáŠ­ áˆ°á‹“á‰µ "Run" á‰¥áˆˆáˆ… áˆ›áˆµáŒ€áˆ˜áˆ­ á‰µá‰½áˆ‹áˆˆáˆ…
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ (Topic)'
        required: false
        default: 'AI Revolution'
      language:
        description: 'á‰‹áŠ•á‰‹ (am/en)'
        required: false
        default: 'am'

permissions:
  contents: write

jobs:
  run_profit_master:
    name: "ğŸš€ Run Profit Master System"
    runs-on: ubuntu-latest
    
    steps:
      # 1. á‹«áŠ•á‰°áŠ• áŠ®á‹µ (main.py) áŠ¨ GitHub á‹«á‹ˆáˆ­á‹°á‹‹áˆ
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      # 2. Python 3.12 á‹«á‹˜áŒ‹áŒƒáˆ
      - name: "ğŸ Setup Python 3.12"
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      # 3. áˆ²áˆµá‰°áˆ áŒ¥áŒˆáŠáŠá‰¶á‰½ (FFmpeg áŠ¥áŠ“ ImageMagick)
      - name: "ğŸ”§ Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg imagemagick
          sudo sed -i 's/none/read,write/g' /etc/ImageMagick-6/policy.xml 2>/dev/null || true

      # 4. á“á‹­á‰°áŠ• áŒ¥áŒˆáŠáŠá‰¶á‰½áŠ• á‰ á‰¡á‹µáŠ• áˆ˜áŒ áŠ• á‹­áŒ­áŠ“áˆ (á‹¨áŒ¥áŒˆáŠáŠá‰µ áŒáŒ­á‰µ áˆˆáˆ›áˆµá‹ˆáŒˆá‹µ)
      - name: "ğŸ“¦ Install Python Libraries"
        run: |
          pip install --upgrade pip
          
          # áˆˆá‹áŒ«á‹Š áˆáŠ•áŒ®á‰½ áˆ˜áˆµáˆ˜áˆ­ áˆ‹á‹­ á‹¨á‰°áŒˆáˆˆáŒ¹ á‹¨á‰°áˆµá‰°áŠ«áŠ¨áˆ‰ áŒ¥áŒˆáŠáŠá‰¶á‰½
          # áˆ˜áˆ°áˆ¨á‰³á‹Š á“áŠ¬áŒ†á‰½
          pip install aiohttp==3.9.0 httpx==0.25.0 requests==2.31.0
          
          # AI áŠ áŒˆáˆáŒáˆá‰¶á‰½
          pip install google-generativeai==0.3.0 openai==0.28.0 groq==0.5.0 anthropic==0.25.0 cohere==4.41
          
          # áˆ™áˆá‰²áˆšá‹²á‹«
          pip install gtts==2.3.0 moviepy==1.0.3 imageio==2.31.1
          pip install pytube==15.0.0 yt-dlp==2023.10.13 Pillow==10.0.0
          
          # á‹µáˆ­ áŠ¥áŠ“ áˆ›áˆ…á‰ áˆ«á‹Š áˆšá‹²á‹«
          pip install tweepy==4.14.0 selenium==4.15.0 beautifulsoup4==4.12.0
          
          # á‰‹áŠ•á‰‹ áˆ›áˆµá‰°áˆ­áŒ“áˆš (deep-translator áŠ¨ googletrans á‹­áˆá‰…)
          pip install langdetect==1.0.9 deep-translator==1.11.4
          
          # NLP
          pip install textblob==0.17.1 nltk==3.8.0 spacy==3.7.0
          
          # á‹¨áˆ›áˆ½áŠ• áˆˆáˆ­áŠ’áŠ•áŒ
          pip install transformers==4.35.0
          
          # á‹¨á‹áˆ‚á‰¥ áˆ˜áˆ áˆ¨á‰µ
          pip install sqlalchemy==2.0.0 redis==5.0.0 celery==5.3.0
          
          # Monitoring áŠ¥áŠ“ Cloud
          pip install prometheus-client==0.19.0 boto3==1.34.0
          
          # API
          pip install fastapi==0.104.0 uvicorn==0.24.0 pydantic==2.4.0
          
          # á‹¨á‹áˆ‚á‰¥ áˆáˆ…á‹‹áˆ­
          pip install pandas==2.0.0 numpy==1.24.0
          
          # áˆŒáˆá‰½
          pip install python-dotenv==1.0.0 psycopg2-binary==2.9.0

      # 5. á‹¨PyTorch áˆá‹© áŒ«áŠ• (CPU á‰¥á‰»)
      - name: "ğŸ¤– Install PyTorch (CPU)"
        run: |
          pip install torch==2.1.0 --index-url https://download.pytorch.org/whl/cpu

      # 6. NLTK á‹áˆ‚á‰¥ áŠ¥áŠ“ spaCy áˆá‹´áˆ
      - name: "ğŸ“š Download NLP Data"
        run: |
          python -c "
          import nltk
          nltk.download('punkt', quiet=True)
          nltk.download('stopwords', quiet=True)
          nltk.download('wordnet', quiet=True)
          print('âœ… NLTK data downloaded')
          "
          
          # spaCy áˆá‹´áˆ
          python -m spacy download en_core_web_sm 2>/dev/null || echo "âš ï¸ spaCy model download skipped"

      # 7. á‹¨áˆµáŠ­áˆªá•á‰µ áˆ›áˆµáŠ¬á‹µ
      - name: "ğŸš€ Execute Main Script"
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ğŸš€ Starting Profit Master System..."
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ¯ Topic: ${{ github.event.inputs.topic || 'AI Revolution' }}"
          echo "ğŸŒ Language: ${{ github.event.inputs.language || 'am' }}"
          
          if [ -f "main.py" ]; then
            # á‰ áˆ˜áŒ€áˆ˜áˆªá‹« áˆµáˆ­á‹“á‰µáŠ• áˆá‰µáŠ•
            echo "ğŸ§ª Running system test..."
            python main.py --test
            
            # áŠ¨á‹šá‹« áˆ™áˆ‰ áˆµáˆ­á‹“á‰µ áŠ áˆµáŠ¬á‹µ
            echo "ğŸ¬ Starting content generation..."
            python main.py \
              --topic "${{ github.event.inputs.topic || 'AI Revolution' }}" \
              --language "${{ github.event.inputs.language || 'am' }}"
          else
            echo "âŒ Error: main.py á‹á‹­áˆ áŠ áˆá‰°áŒˆáŠ˜áˆ!"
            exit 1
          fi

      # 8. á‹áŒ¤á‰¶á‰½ áˆ›áˆµá‰€áˆ˜áŒ¥
      - name: "ğŸ’¾ Upload Artifacts"
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: profit-master-results
          path: |
            profit_master.log
            profit_master_v16.log
            generated_content/
            output/
            *.json
            *.html
            *.txt
            *.md
          retention-days: 7

      # 9. áˆˆáˆšá‰€áŒ¥áˆˆá‹ áˆ‚á‹°á‰µ áˆ›áˆ¨áŒ‹áŒˆáŒ«
      - name: "âœ… Completion Status"
        if: always()
        run: |
          if [ -f "profit_master.log" ]; then
            echo "ğŸ“Š Log file created: profit_master.log"
            echo "ğŸ” Last 10 lines of log:"
            tail -10 profit_master.log || echo "No log content"
          else
            echo "âš ï¸ No log file created"
          fi
          
          echo "ğŸ Job completed at: $(date)"
