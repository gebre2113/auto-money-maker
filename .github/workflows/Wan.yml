name: Profit Master Supreme - EXECUTE

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ'
        required: false
        default: 'AI Revolution'
      language:
        description: 'á‰‹áŠ•á‰‹ (am/en)'
        required: false
        default: 'am'

permissions:
  contents: write

jobs:
  run_profit_master:
    name: "ğŸš€ Run Profit Master System"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ğŸ Setup Python 3.12"
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: "ğŸ”§ Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg imagemagick wget
          sudo sed -i 's/none/read,write/g' /etc/ImageMagick-6/policy.xml 2>/dev/null || true

      - name: "ğŸ“¦ Install Python Dependencies from requirements.txt"
        run: |
          pip install --upgrade pip
          # á‰ á‰€áˆ‹áˆ‰ á‹‹áŠ“ á‹‹áŠ“ á“áŠ¬áŒ†á‰½áŠ• á‹­áŒ­áŠ‘
          pip install aiohttp httpx google-generativeai gtts
          pip install moviepy==1.0.3 imageio==2.31.1
          pip install deep-translator  # áŠ¨ googletrans á‹­áˆá‰…
          pip install pandas numpy<2.0.0
          
          # á‰€áˆªá‹á‰¹áŠ• á‰ á‰€áˆ‹áˆ‰
          pip install pytube yt-dlp tweepy selenium beautifulsoup4 \
            langdetect textblob nltk spacy openai transformers \
            sqlalchemy redis celery prometheus-client boto3 \
            fastapi uvicorn pydantic pillow

      - name: "ğŸ“¥ Install PyTorch (CPU)"
        run: |
          pip install torch --index-url https://download.pytorch.org/whl/cpu

      - name: "ğŸ“¥ Download NLTK Data"
        run: |
          python -c "import nltk; nltk.download('punkt', quiet=True); nltk.download('stopwords', quiet=True); nltk.download('wordnet', quiet=True)"

      - name: "ğŸ¤– Execute Main Script"
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ğŸš€ Starting Profit Master System..."
          
          if [ -f "main.py" ]; then
            # á‰ áˆ˜áŒ€áˆ˜áˆªá‹« áˆá‰°áŠ“ áŠ áˆµáŠ¬á‹µ
            echo "ğŸ§ª Running system test..."
            python main.py --topic "Test" --language "am" --test
            
            # áŠ¨á‹šá‹« áˆ™áˆ‰ áˆµáˆ­á‹“á‰µ
            echo "ğŸ¯ Running full system..."
            python main.py --topic "${{ github.event.inputs.topic || 'AI Revolution' }}" --language "${{ github.event.inputs.language || 'am' }}"
          else
            echo "âŒ Error: main.py not found"
            exit 1
          fi

      - name: "ğŸ’¾ Upload Results"
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: profit-master-output
          path: |
            profit_master.log
            *.json
            *.html
            *.txt
          retention-days: 5
