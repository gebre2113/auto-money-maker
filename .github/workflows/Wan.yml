name: Profit Master Supreme - EXECUTE

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ'
        required: false
        default: 'AI Revolution'
      language:
        description: 'á‰‹áŠ•á‰‹ (am/en)'
        required: false
        default: 'am'

permissions:
  contents: write

jobs:
  run_profit_master:
    name: "ðŸš€ Run Profit Master System"
    runs-on: ubuntu-latest
    
    steps:
      - name: "ðŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ðŸ Setup Python 3.12"
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: "ðŸ”§ Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg imagemagick
          sudo sed -i 's/none/read,write/g' /etc/ImageMagick-6/policy.xml 2>/dev/null || echo "ImageMagick policy not found"

      - name: "ðŸ“¦ Install Python Dependencies"
        run: |
          pip install --upgrade pip
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          else
            echo "requirements.txt not found, installing manually..."
            pip install aiohttp httpx google-generativeai gtts moviepy==1.0.3 pytube yt-dlp \
              tweepy selenium beautifulsoup4 langdetect googletrans==3.1.0a0 textblob \
              nltk spacy openai transformers torch sqlalchemy redis celery \
              prometheus-client boto3 fastapi uvicorn pydantic pillow pandas numpy<2.0.0
          fi

      - name: "ðŸ“¥ Download NLTK Data"
        run: |
          python -c "import nltk; nltk.download('punkt', quiet=True); nltk.download('stopwords', quiet=True); nltk.download('wordnet', quiet=True)"

      - name: "ðŸ¤– Execute Main Script"
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "ðŸš€ Starting Profit Master System..."
          
          if [ -f "main.py" ]; then
            python main.py --topic "${{ github.event.inputs.topic || 'AI Revolution' }}" --language "${{ github.event.inputs.language || 'am' }}"
          else
            echo "âŒ Error: main.py not found"
            exit 1
          fi

      - name: "ðŸ’¾ Upload Results"
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: profit-master-output
          path: |
            profit_master.log
            generated_content/
            *.json
            *.html
            *.txt
          retention-days: 5
