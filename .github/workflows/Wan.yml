name: Profit Master Supreme - EXECUTE

on:
  schedule:
    - cron: '0 */6 * * *'  # á‰ á‹¨ 6 áˆ°á‹“á‰± á‹­áˆ°áˆ«áˆ
  workflow_dispatch:       # á‰ áŠ¥áŒ… áˆ›áˆµáŒ€áˆ˜áˆ­
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ'
        required: false
        default: 'AI Revolution'
      language:
        description: 'á‰‹áŠ•á‰‹ (am/en)'
        required: false
        default: 'am'

permissions:
  contents: write

jobs:
  run_profit_master:
    name: "ğŸš€ Run Profit Master System"
    runs-on: ubuntu-latest
    
    steps:
      # 1. áŠ®á‹µ áˆ˜á‹áˆ¨á‹µ
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      # 2. Python áˆ›á‹‹á‰€áˆ­
      - name: "ğŸ Setup Python 3.12"
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      # 3. á‹¨áˆ²áˆµá‰°áˆ áŒ¥áŒˆáŠáŠá‰¶á‰½
      - name: "ğŸ”§ Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg imagemagick
          sudo sed -i 's/none/read,write/g' /etc/ImageMagick-6/policy.xml 2>/dev/null || true

      # 4. á“á‹­á‰°áŠ• áŒ¥áŒˆáŠáŠá‰¶á‰½
      - name: "ğŸ“¦ Install Python Dependencies"
        run: |
          pip install --upgrade pip
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          else
            echo "âŒ requirements.txt not found!"
            exit 1
          fi

      # 5. á‹¨PyTorch áˆá‹© áŒ«áŠ• (CPU)
      - name: "ğŸ¤– Install PyTorch (CPU)"
        run: |
          pip install torch --index-url https://download.pytorch.org/whl/cpu

      # 6. NLTK á‹áˆ‚á‰¥
      - name: "ğŸ“š Download NLTK Data"
        run: |
          python -c "
          import nltk
          nltk.download('punkt', quiet=True)
          nltk.download('stopwords', quiet=True)
          nltk.download('wordnet', quiet=True)
          print('âœ… NLTK data downloaded')
          "

      # 7. á‹¨áˆµáŠ­áˆªá•á‰µ áˆ›áˆµáŠ¬á‹µ
      - name: "ğŸš€ Execute Main Script"
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ğŸš€ Starting Profit Master System..."
          echo "ğŸ“Š Dependencies installed successfully"
          
          if [ -f "main.py" ]; then
            # áŠ áˆ›áˆ«áŒ­ áŠáŒ‹áˆªá‰µ áŠ¥áŠ•á‹²á‰€á‰ áˆ
            python main.py \
              --topic "${{ github.event.inputs.topic || 'AI Revolution' }}" \
              --language "${{ github.event.inputs.language || 'am' }}"
          else
            echo "âŒ Error: main.py not found!"
            exit 1
          fi

      # 8. á‹áŒ¤á‰¶á‰½ áˆ›áˆµá‰€áˆ˜áŒ¥
      - name: "ğŸ’¾ Upload Artifacts"
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: profit-master-results
          path: |
            profit_master.log
            *.json
            *.html
            *.txt
            generated_content/
            output/
          retention-days: 7
