name: üëë TITAN v22.0 ULTIMATE MULTI-CHANNEL ORACLE

on:
  schedule:
    - cron: '0 */6 * * *' # ·â†·ã® 6 ·à∞·ãì·â± ·â†·à´·àµ-·à∞·à≠
  workflow_dispatch:
    inputs:
      topic:
        description: 'Target Topic (e.g., Global Finance 2026)'
        required: false
        default: 'Future of Global Wealth and AI 2026'

permissions:
  contents: write
  issues: write

concurrency:
  group: production-pipeline
  cancel-in-progress: true

jobs:
  run-sovereign-engine:
    name: üëë Execute Ultimate Production & Distribution
    runs-on: ubuntu-latest
    timeout-minutes: 120 

    steps:
    - name: üì• Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: üêç Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: üõ†Ô∏è Install Essential System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg  # ·àà·â™·ã≤·ãÆ/·ãµ·àù·çÖ ·à•·à´ ·â•·âª

    - name: üì¶ Install Python Dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        pip install tenacity requests psutil python-dotenv pyyaml aiohttp \
                    google-generativeai groq openai \
                    beautifulsoup4 pandas jinja2 lxml \
                    textblob nltk numpy redis \
                    python-wordpress-xmlrpc facebook-sdk tweepy pydantic[email] httpx

        # ·ã®·âã·äï·âã ·àõ·âÄ·äê·â£·â†·à™·ã´ ·ã≥·â≥·ãé·âΩ·äï ·â†·çç·å•·äê·âµ ·àò·å´·äï
        python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger_eng
        
    - name: üëë Run Unified Sovereign Engine
      env:
        # --- AI API KEYS (7-KEY ROTATION) ---
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GROQ_API_KEY_1: ${{ secrets.GROQ_API_KEY_1 }}
        GROQ_API_KEY_2: ${{ secrets.GROQ_API_KEY_2 }}
        GROQ_API_KEY_3: ${{ secrets.GROQ_API_KEY_3 }}
        GROQ_API_KEY_4: ${{ secrets.GROQ_API_KEY_4 }}
        GROQ_API_KEY_5: ${{ secrets.GROQ_API_KEY_5 }}
        GROQ_API_KEY_6: ${{ secrets.GROQ_API_KEY_6 }}
        GROQ_API_KEY_7: ${{ secrets.GROQ_API_KEY_7 }}
        
        # --- OTHER AI PROVIDERS ---
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}

        # --- DISTRIBUTION KEYS ---
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
        FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        LINKEDIN_TOKEN: ${{ secrets.LINKEDIN_TOKEN }}
        LINKEDIN_URN: ${{ secrets.LINKEDIN_URN }}
        
        # --- SYSTEM CONFIG ---
        INPUT_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        GITHUB_ACTIONS: "true"
        PYTHONUNBUFFERED: 1
      run: |
        echo "üöÄ Starting Unified Sovereign Engine..."
        # ·à´·äê·à©·äï ·àõ·àµ·åÄ·àò·à≠ - ·ã® 10 ·âÅ·å•·à≠ ·àù·à≠·å´·äï ·ä•·äì ·à≠·ãï·àµ·äï ·â†·à´·àµ ·à∞·à≠ ·ã≠·àç·ä´·àç
        python main.py <<EOF
        10
        $INPUT_TOPIC
        EOF

    - name: üìä Update GitHub Enterprise Dashboard
      if: success()
      run: |
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
        TOPIC="${{ github.event.inputs.topic || 'Automated Run' }}"
        curl -X POST \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          -d "{\"title\": \"‚úÖ Production: $TOPIC [$TIMESTAMP]\", \"body\": \"Production finished successfully. 11 Countries processed with 7,000+ words each. Check enterprise_outputs for details.\"}" \
          "https://api.github.com/repos/${{ github.repository }}/issues"

    - name: üì§ Sync & Push to GitHub
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Sovereign-Bot üëë"
        mkdir -p enterprise_outputs production_backups enterprise_logs ai_usage_logs
        git add .
        if git diff --staged --quiet; then
          echo "üö´ No changes to commit."
        else
          echo "‚úÖ Changes detected. Pushing to repository..."
          git commit -m "üëë Sovereign Output: [Run ${{ github.run_number }}]"
          git pull --rebase origin main
          git push origin main
        fi

    - name: üíæ Archive Production Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: sovereign-results-final
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
