name: ğŸš€ Profit Master Elite - PRODUCTION RUN ON

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰± áˆ­á‹•áˆµ (Content Topic)'
        required: false
        default: 'AI-Powered Content Creation Strategies 2026'
  schedule:
    - cron: '0 0 * * *' # á‰ á‹¨á‰€áŠ‘ áŠ¥áŠ©áˆˆ áˆŒáˆŠá‰µ á‰ áˆ«áˆ± á‹­áŒ€áˆáˆ«áˆ

permissions:
  contents: write # á‹ˆá‹° GitHub Dashboard áˆˆáˆ˜áŒ«áŠ• (Push áˆˆáˆ›á‹µáˆ¨áŒ) áŠ áˆµáˆáˆ‹áŒŠ áŠá‹

jobs:
  run-profit-machine:
    name: ğŸ­ Running The Elite Machine
    runs-on: ubuntu-latest
    
    services:
      redis:
        image: redis
        ports:
          - 6379:6379

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # áˆ™áˆ‰ á‹¨ Git á‰³áˆªáŠ­áŠ• áˆˆáˆ›áŒáŠ˜á‰µ

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: ğŸ¥ Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg chromium-browser chromium-chromedriver

    - name: ğŸ“¦ Install Python Libraries (Elite Dependency Fix)
      run: |
        python -m pip install --upgrade pip
        # psutil áŠ¥áŠ“ áˆŒáˆá‰½ áˆˆ WordPress/Telegram á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ á‰°áŒ¨áˆáˆ¨á‹‹áˆ
        pip install psutil aiohttp aioredis==2.0.1 python-dotenv
        pip install PyYAML groq google-generativeai moviepy==1.0.3 pandas requests beautifulsoup4 jinja2 googletrans==3.1.0a0
        pip install textblob pydantic==1.10.11 tenacity
        pip install fastapi==0.104.0 uvicorn==0.24.0 httpx==0.25.0 openai==1.3.0 sqlalchemy==2.0.0 redis
        python -m textblob.download_corpora

    - name: ğŸš€ Run & Deploy Profit Master
      env:
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        REDIS_URL: redis://localhost:6379
        PYTHONPATH: .
      run: |
        echo "ğŸ”¥ Starting Production Engine (Elite Mode)..."
        # áŒ½áˆá‰áŠ• áŠ áˆáˆ­á‰¶ á‹ˆá‹° WordPress áŠ¥áŠ“ Telegram á‹­áˆáŠ«áˆ
        python main_runner.py --topic "${{ github.event.inputs.topic || 'AI-Powered Content Creation Strategies 2026' }}"

    - name: ğŸ“¤ Deploy Results to GitHub Dashboard
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"
        
        # áŠ á‹³á‹²áˆµ á‹¨á‹ˆáŒ¡ á‹áŒ¤á‰¶á‰½áŠ• (outputs) á‰¥á‰» áˆ˜áˆ­áŒ¦ á‹­áŒ­áŠ“áˆ
        git add premium_outputs/ production_outputs/ logs/ premium_logs/ || echo "áˆáŠ•áˆ áŠ á‹²áˆµ á‹á‹­áˆ á‹¨áˆˆáˆ"
        
        # áˆˆá‹áŒ¥ áŠ«áˆˆ á‰¥á‰» Commit á‹«á‹°áˆ­áŒ‹áˆ
        if git diff --quiet && git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ğŸš€ Automated Production Sync: ${{ github.run_id }} [skip ci]"
          git push origin main
        fi

    - name: ğŸ’¾ Archive Artifacts (Backup)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: elite-production-full-package
        path: |
          premium_outputs/
          *.html
          *.json
