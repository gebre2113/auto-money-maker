name: üëë TITAN v22.0 ULTIMATE MULTI-CHANNEL ORACLE

on:
  schedule:
    # ·â†·ã® 30 ·ã∞·âÇ·âÉ·ãç ·ä•·äï·ã≤·äê·à≥ ·â∞·àµ·â∞·ä´·ä≠·àè·àç (·ã∞·âÇ·âÉ 0 ·ä•·äì 30 ·àã·ã≠)
    - cron: '*/30 * * * *'
  workflow_dispatch:
    inputs:
      topic:
        description: 'Target Topic (e.g., Global Finance 2026)'
        required: false
        default: 'Future of Global Wealth and AI 2026'

permissions:
  contents: write
  issues: write

concurrency:
  group: production-pipeline
  cancel-in-progress: true

jobs:
  run-sovereign-engine:
    name: üëë Execute Ultimate Production & Distribution
    runs-on: ubuntu-latest
    timeout-minutes: 120 

    steps:
    - name: üì• Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: üêç Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    - name: üõ†Ô∏è Install Essential System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg

    - name: üì¶ Install Python Dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        # ·àÅ·àâ·àù ·ãà·à≥·äù ·å•·åà·äû·âΩ ·ä•·ãö·àÖ ·â∞·ãò·à≠·ãù·à®·ãã·àç ‚Äî jsonschema ·â∞·å®·àù·àØ·àç!
        pip install tenacity requests psutil python-dotenv pyyaml aiohttp \
                    google-generativeai groq openai pytz \
                    beautifulsoup4 pandas jinja2 lxml \
                    textblob nltk numpy redis \
                    python-wordpress-xmlrpc facebook-sdk tweepy pydantic[email] httpx \
                    jsonschema

        python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger_eng
        
    - name: üëë Run Unified Sovereign Engine
      env:
        # --- AI API KEYS (15-KEY ROTATION & BACKUP) ---
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GROQ_API_KEY_1: ${{ secrets.GROQ_API_KEY_1 }}
        GROQ_API_KEY_2: ${{ secrets.GROQ_API_KEY_2 }}
        GROQ_API_KEY_3: ${{ secrets.GROQ_API_KEY_3 }}
        GROQ_API_KEY_4: ${{ secrets.GROQ_API_KEY_4 }}
        GROQ_API_KEY_5: ${{ secrets.GROQ_API_KEY_5 }}
        GROQ_API_KEY_6: ${{ secrets.GROQ_API_KEY_6 }}
        GROQ_API_KEY_7: ${{ secrets.GROQ_API_KEY_7 }}
        GROQ_API_KEY_8: ${{ secrets.GROQ_API_KEY_8 }}
        GROQ_API_KEY_9: ${{ secrets.GROQ_API_KEY_9 }}
        GROQ_API_KEY_10: ${{ secrets.GROQ_API_KEY_10 }}
        GROQ_API_KEY_11: ${{ secrets.GROQ_API_KEY_11 }}
        GROQ_API_KEY_12: ${{ secrets.GROQ_API_KEY_12 }}
        GROQ_API_KEY_13: ${{ secrets.GROQ_API_KEY_13 }}
        GROQ_API_KEY_14: ${{ secrets.GROQ_API_KEY_14 }}
        GROQ_API_KEY_15: ${{ secrets.GROQ_API_KEY_15 }}
        
        # --- OTHER AI PROVIDERS ---
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}

        # --- DISTRIBUTION KEYS ---
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
        FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        LINKEDIN_TOKEN: ${{ secrets.LINKEDIN_TOKEN }}
        LINKEDIN_URN: ${{ secrets.LINKEDIN_URN }}
        
        # --- SYSTEM CONFIG ---
        INPUT_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        GITHUB_ACTIONS: "true"
        PYTHONUNBUFFERED: 1
      run: |
        echo "üöÄ Starting Unified Sovereign Engine with Time-Zone Optimization..."
        # ·à´·äê·à© ·ä†·àÅ·äï 15,000 ·âÉ·àã·âµ·äï ·ä•·äì ·ã®·à∞·ãì·âµ ·àé·åÇ·ä≠·äï ·ä•·äï·ã≤·ã´·àµ·â∞·äì·åç·ãµ ·â∞·ã∞·à≠·åì·àç
        python enterprise_runner.py <<EOF
        15
        $INPUT_TOPIC
        EOF

    - name: üìä Update GitHub Enterprise Dashboard
      if: success()
      run: |
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
        TOPIC="${{ github.event.inputs.topic || 'Automated Time-Sensitive Run' }}"
        curl -X POST \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          -d "{\"title\": \"‚úÖ Production: $TOPIC [$TIMESTAMP]\", \"body\": \"Production finished. Time-zone filtering applied. Check logs for active country list.\"}" \
          "https://api.github.com/repos/${{ github.repository }}/issues"

    - name: üì§ Sync & Push to GitHub
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Sovereign-Bot üëë"
        mkdir -p enterprise_outputs production_backups enterprise_logs ai_usage_logs
        git add .
        if git diff --staged --quiet; then
          echo "üö´ No changes to commit."
        else
          git commit -m "üëë Sovereign Output [Run ${{ github.run_number }}] - Time-Zone Optimized"
          git pull --rebase origin main
          git push origin main
        fi

    - name: üíæ Archive Production Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: sovereign-results-final
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
