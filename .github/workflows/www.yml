name: ğŸš€ Profit Master Elite - ULTIMATE PRODUCTION ON

on:
  # 1. á‰ áŠ¥áŒ… áˆ›áˆµáŒ€áˆ˜áˆ­
  workflow_dispatch:
    inputs:
      topic:
        description: 'Target Topic (e.g., Enterprise AI 2026)'
        required: false
        default: 'Enterprise AI Implementation Strategies 2026'
      
  # 2. á‰ á‹¨á‰€áŠ‘ áŒ á‹‹á‰µ 12:00 (6:00 UTC) á‰ áˆ«áˆµ áˆ°áˆ­ á‹­áŠáˆ³áˆ
  schedule:
    - cron: '0 6 * * *'

# ğŸ” áˆá‰ƒá‹¶á‰½
permissions:
  contents: write
  actions: read

jobs:
  run-enterprise-engine:
    name: ğŸ­ Run Enterprise Engine
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
    # 1. áŠ®á‹±áŠ• áˆ›á‹áˆ¨á‹µ
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. á“á‹­á‰°áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
    - name: ğŸ Set up Python 3.10
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    # 3. á‹¨áˆ²áˆµá‰°áˆ áˆ¶áá‰µá‹Œáˆ®á‰½
    - name: ğŸ¥ Install System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg

    # 4. á“á‹­á‰°áŠ• áˆ‹á‹­á‰¥áˆ¨áˆªá‹á‰½ (tenacity áŠ¥áŠ“ áˆŒáˆá‰½ á‹¨á‰°áˆŸáˆ‰)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        # Core & Robustness
        pip install tenacity requests psutil python-dotenv pyyaml aiohttp asyncio
        # AI Engines
        pip install google-generativeai groq openai
        # Content Processing
        pip install beautifulsoup4 pandas jinja2 lxml
        # Publishing & Integration
        pip install python-wordpress-xmlrpc
        # Requirements.txt áŠ«áˆˆ áŠ¥áˆ±áŠ•áˆ á‹­áŒ¨áˆáˆ­
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 5. áˆµáˆ«á‹áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ (The Main Engine)
    - name: ğŸš€ Execute Enterprise Runner
      env:
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        ENTERPRISE_TOPIC: ${{ github.event.inputs.topic || 'Enterprise AI Implementation Strategies 2026' }}
        PYTHONPATH: .
      run: |
        echo "ğŸ”¥ Starting Production Engine for topic: $ENTERPRISE_TOPIC"
        set +e 
        python enterprise_runner.py
        exit_code=$?
        if [ $exit_code -ne 0 ]; then
          echo "âš ï¸ Script finished with warnings (Code: $exit_code)"
        else
          echo "âœ… Script finished successfully"
        fi

    # 6. á‹áŒ¤á‰±áŠ• á‹ˆá‹° GitHub áˆ˜áˆáˆ¶ áˆ˜áŒ«áŠ•
    - name: ğŸ“¤ Commit & Push Results
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Enterprise Bot ğŸ¤–"
        
        # áŠ áˆµáˆáˆ‹áŒŠ á‹¨áˆ†áŠ‘ ááˆá‹°áˆ®á‰½ áˆ˜áŠ–áˆ«á‰¸á‹áŠ• áŠ áˆ¨áŒ‹áŒáŒ¥
        mkdir -p enterprise_outputs production_backups enterprise_logs ai_usage_logs
        
        git add enterprise_outputs/ production_backups/ enterprise_logs/ ai_usage_logs/ || true
        
        if git diff --staged --quiet; then
          echo "ğŸš« No changes to commit."
        else
          echo "âœ… Changes detected. Committing..."
          git commit -m "ğŸš€ Enterprise Output: [${{ github.run_id }}]"
          git pull --rebase origin main
          git push origin main
        fi

    # 7. á‹á‹­áˆá‰¹áŠ• áˆˆá‹³á‹áˆá‹µ áˆ›á‹˜áŒ‹áŒ€á‰µ (Artifacts)
    - name: ğŸ’¾ Upload Artifacts (Zip)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: enterprise-production-results
        retention-days: 90
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
          *.json
          *.md
