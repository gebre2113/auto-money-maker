name: ğŸš€ Profit Master Elite - PRODUCTION RUN on

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰± áˆ­á‹•áˆµ (Content Topic)'
        required: false
        default: 'AI-Powered Content Creation Strategies 2026'
  schedule:
    - cron: '0 0 * * *' # á‰ á‹¨á‰€áŠ‘ á‰ áŒ á‹‹á‰µ 12 áˆ°á‹“á‰µ á‰ áˆ«áˆ± á‹­áŠáˆ³áˆ

jobs:
  run-profit-machine:
    name: ğŸ­ Running The Elite Machine
    runs-on: ubuntu-22.04
    
    services:
      redis:
        image: redis
        ports:
          - 6379:6379

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: ğŸ¥ Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg chromium-browser chromium-chromedriver

    - name: ğŸ“¦ Install Python Libraries
      run: |
        python -m pip install --upgrade pip
        # áˆ˜áŒ€áˆ˜áˆªá‹« PyYAML áŠ¥áŠ“ áˆŒáˆá‰½ á‹‹áŠ“ á‹‹áŠ“á‹á‰¹áŠ• áŠ¥áŠ•áŒ«áŠ•
        pip install PyYAML groq google-generativeai moviepy==1.0.3 pandas requests beautifulsoup4
        pip install python-dotenv redis aioredis==2.0.1 aiohttp textblob pydantic==1.10.11 tenacity
        # áŠ¨á‹šá‹« requirements_minimal.txt á‹áˆµáŒ¥ á‹«áˆ‰á‰µáŠ• á‰€áˆªá‹á‰½ á‹­áŒ­áŠ“áˆ
        if [ -f requirements_minimal.txt ]; then pip install -r requirements_minimal.txt; fi
        # á‹¨á‰‹áŠ•á‰‹ áˆ›á‰€áŠá‰£á‰ áˆªá‹« á‹³á‰³áŠ• áˆ˜áŒ«áŠ•
        python -m textblob.download_corpora

    - name: ğŸš€ Run & Deploy Profit Master
      env:
        # AI APIs
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
        
        # WordPress Deployment
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        
        # Telegram Deployment
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        
        REDIS_URL: redis://localhost:6379
      run: |
        echo "ğŸ”¥ Starting Production Engine and Deploying to WP & Telegram..."
        # á‹¨ topic áˆáˆ­áŒ«á‹áŠ• áŠ¨ input á‹ˆá‹­áˆ áŠ¨ default á‹­á‹ˆáˆµá‹³áˆ
        python main_runner.py --topic "${{ github.event.inputs.topic || 'AI-Powered Content Creation Strategies 2026' }}"

    - name: ğŸ’¾ Save Production Output
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: elite-production-results
        path: |
          production_outputs/
          logs/
          *.json
          *.txt
          *.log
