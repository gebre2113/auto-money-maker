name: ğŸ‘‘ TITAN v21.0: THE UNIFIED SOVEREIGN - AUTOMATION 

on:
  # 1. á‰ á‹¨ 6 áˆ°á‹“á‰± á‰ áˆ«áˆµ-áˆ°áˆ­ á‹­áŠáˆ³áˆ
  schedule:
    - cron: '0 */6 * * *'
      
  # 2. á‰ áˆ›áŠ•áŠ›á‹áˆ áŒŠá‹œ á‰ áŠ¥áŒ… áˆˆáˆ›áˆµáŒ€áˆ˜áˆ­
  workflow_dispatch:
    inputs:
      topic:
        description: 'Target Topic (e.g., Future of AI 2026)'
        required: false
        default: 'Emerging AI Technologies and Global Economic Impact 2026'
      language:
        description: 'Language'
        required: false
        default: 'en'

# á‹¨áˆ²áˆµá‰°áˆ áˆá‰ƒá‹¶á‰½
permissions:
  contents: write
  issues: write
  actions: read

# á‰°á‹°áŒ‹áŒ‹áˆš áˆµáˆ«á‹á‰½áŠ• áˆˆáˆ˜áŠ¨áˆ‹áŠ¨áˆ (Concurrency)
concurrency:
  group: production-pipeline
  cancel-in-progress: true

jobs:
  run-sovereign-engine:
    name: ğŸ‘‘ Execute Sovereign Production
    runs-on: ubuntu-latest
    timeout-minutes: 120 # áˆ¨áŒ…áˆ á‹­á‹˜á‰µ áˆµáˆˆáˆ†áŠ áŒŠá‹œ áŠ¥áŠ•áˆ°áŒ á‹‹áˆˆáŠ•

    steps:
    # 1. áŠ®á‹±áŠ• áˆ›á‹áˆ¨á‹µ
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. á“á‹­á‰°áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ (Latest Stable)
    - name: ğŸ Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    # 3. á‹¨áˆ²áˆµá‰°áˆ áˆ¶áá‰µá‹Œáˆ®á‰½ (áˆˆá‰ªá‹²á‹® áŠ¥áŠ“ áˆáˆµáˆ áˆ‚á‹°á‰µ)
    - name: ğŸ¥ Install System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg

    # 4. á“á‹­á‰°áŠ• áˆ‹á‹­á‰¥áˆ¨áˆªá‹á‰½ (áˆáˆ‰áŠ•áˆ á‹¨áˆ‹á‰ áˆáŒáˆá‰½áŠ• á‹«áŠ«á‰µá‰³áˆ)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install tenacity requests psutil python-dotenv pyyaml aiohttp asyncio \
                    google-generativeai groq openai \
                    beautifulsoup4 pandas jinja2 lxml \
                    textblob nltk numpy \
                    python-wordpress-xmlrpc
        
        # á‹¨á‰‹áŠ•á‰‹ áˆ›á‰€áŠá‰£á‰ áˆªá‹« á‹³á‰³á‹á‰½áŠ• áˆ›á‹áˆ¨á‹µ
        python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger_eng
        
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 5. á‹¨áˆœáŒ‹ áˆáˆ­á‰µ áˆ‚á‹°á‰µáŠ• áˆ›áˆµáŒ€áˆ˜áˆ­
    - name: ğŸ‘‘ Run Unified Sovereign Engine
      env:
        # --- AI API KEYS (MULTI-KEY ROTATION) ---
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GROQ_API_KEY_1: ${{ secrets.GROQ_API_KEY_1 }}
        GROQ_API_KEY_2: ${{ secrets.GROQ_API_KEY_2 }}
        GROQ_API_KEY_3: ${{ secrets.GROQ_API_KEY_3 }}
        GROQ_API_KEY_4: ${{ secrets.GROQ_API_KEY_4 }}
        GROQ_API_KEY_5: ${{ secrets.GROQ_API_KEY_5 }}
        GROQ_API_KEY_6: ${{ secrets.GROQ_API_KEY_6 }}
        GROQ_API_KEY_7: ${{ secrets.GROQ_API_KEY_7 }}
        
        # --- OTHER AI PROVIDERS ---
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}

        # --- DISTRIBUTION KEYS ---
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        
        # --- CONFIGURATION ---
        ENTERPRISE_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        INPUT_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        GITHUB_ACTIONS: "true"
        PYTHONPATH: .
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸš€ Starting Unified Sovereign Engine..."
        echo "ğŸŒ Target Topic: $INPUT_TOPIC"
        # áˆ«áŠáˆ©áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ - á‹¨ 10 á‰áŒ¥áˆ­ áˆáˆ­áŒ«áŠ• á‰ áˆ«áˆµ áˆ°áˆ­ á‹­áˆáŠ«áˆ
        python main.py <<EOF
        10
        $INPUT_TOPIC
        EOF

    # 6. á‹¨áˆªá–áˆ­á‰µ áˆ›áŒ á‰ƒáˆˆá‹« áˆˆ GitHub Issues áˆ˜áˆ‹áŠ­
    - name: ğŸ“ Create GitHub Issue Summary
      if: success()
      run: |
        curl -X POST \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          -d "{\"title\": \"âœ… Production Complete: ${{ github.event.inputs.topic || 'Auto-Run' }}\", \"body\": \"### ğŸ‘‘ Sovereign Production Summary\n- **Topic:** ${{ github.event.inputs.topic || 'Scheduled' }}\n- **Status:** Successfully generated and distributed.\n- **Timestamp:** $(date)\n\nCheck `enterprise_outputs` for full reports.\"}" \
          "https://api.github.com/repos/${{ github.repository }}/issues"

    # 7. áŠ á‹³á‹²áˆµ á‹á‹­áˆá‰½áŠ• á‹ˆá‹° áˆªá–á‹šá‰¶áˆª áˆ˜áˆ˜áˆˆáˆµ
    - name: ğŸ“¤ Commit & Push Results
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Sovereign-Bot ğŸ‘‘"
        
        # áˆ›áˆ…á‹°áˆ®á‰½áŠ• áˆ˜ááŒ áˆ­
        mkdir -p enterprise_outputs production_backups enterprise_logs ai_usage_logs
        
        git add enterprise_outputs/ production_backups/ enterprise_logs/ ai_usage_logs/ *.html *.json *.md || true
        
        if git diff --staged --quiet; then
          echo "ğŸš« No changes to commit."
        else
          echo "âœ… Changes detected. Syncing with remote..."
          git commit -m "ğŸ‘‘ Sovereign Output: [Run ${{ github.run_number }}] - $INPUT_TOPIC"
          git pull --rebase origin main
          git push origin main
        fi

    # 8. áŠ áˆ­á‰²á‹áŠ­á‰¶á‰½áŠ• áˆ›áˆµá‰€áˆ˜áŒ¥ (áˆˆáˆ›á‹áˆ¨á‹µ áŠ¥áŠ•á‹²áˆ˜á‰½)
    - name: ğŸ’¾ Archive Production Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: sovereign-production-v21
        retention-days: 30
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
          *.json
