name: ğŸ‘‘ TITAN v22.0 ULTIMATE MULTI-CHANNEL ORACLE

on:
  # á‰ á‹¨ 6 áˆ°á‹“á‰± á‰ áˆ«áˆµ-áˆ°áˆ­ áŠ¥áŠ•á‹²áŠáˆ³
  schedule:
    - cron: '0 */6 * * *'
      
  # á‰ áˆ›áŠ•áŠ›á‹áˆ áŒŠá‹œ á‰ áŠ¥áŒ… áˆˆáˆ›áˆµáŒ€áˆ˜áˆ­
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰µ áˆ­á‹•áˆµ (Topic)'
        required: false
        default: 'Future of Global Wealth and AI 2026'

permissions:
  contents: write
  issues: write
  actions: read

concurrency:
  group: production-pipeline
  cancel-in-progress: true

jobs:
  run-sovereign-engine:
    name: ğŸ‘‘ Execute Ultimate Production & Distribution
    runs-on: ubuntu-latest
    timeout-minutes: 180 

    steps:
    # 1. áŠ®á‹±áŠ• áŠ¨áˆªá–á‹šá‰¶áˆªá‹ áˆ›á‹áˆ¨á‹µ
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    # 2. á“á‹­á‰°áŠ• 3.12 áˆ›á‹˜áŒ‹áŒ€á‰µ
    - name: ğŸ Set up Python 3.12
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        cache: 'pip'

    # 3. á‹¨áˆ²áˆµá‰°áˆ áˆ¶áá‰µá‹Œáˆ®á‰½áŠ• áˆ˜áŒ«áŠ• (áˆˆá‰ªá‹²á‹® áŠ¥áŠ“ áˆáˆµáˆ)
    - name: ğŸ¥ Install System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg libmagick++-dev

    # 4. á“á‹­á‰°áŠ• áˆ‹á‹­á‰¥áˆ¨áˆªá‹á‰½áŠ• áˆ˜áŒ«áŠ• (áˆµáˆ…á‰°á‰± áŠ¥á‹šáˆ… á‰°áˆµá‰°áŠ«áŠ­áˆáˆ)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        pip install tenacity requests psutil python-dotenv pyyaml aiohttp \
                    google-generativeai groq openai \
                    beautifulsoup4 pandas jinja2 lxml \
                    textblob nltk numpy redis \
                    python-wordpress-xmlrpc facebook-sdk tweepy pydantic httpx
        
        # á‹¨á‰‹áŠ•á‰‹ áˆ›á‰€áŠá‰£á‰ áˆªá‹« á‹³á‰³á‹á‰½áŠ• áˆ›á‹áˆ¨á‹µ
        python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger_eng
        
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 5. á‹¨áˆœáŒ‹ áˆáˆ­á‰µ áŠ¥áŠ“ á‹¨áˆµáˆ­áŒ­á‰µ áˆ‚á‹°á‰µáŠ• áˆ›áˆµáŒ€áˆ˜áˆ­
    - name: ğŸ‘‘ Run Unified Sovereign Engine
      env:
        # --- AI API KEYS (7-KEY ROTATION) ---
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GROQ_API_KEY_1: ${{ secrets.GROQ_API_KEY_1 }}
        GROQ_API_KEY_2: ${{ secrets.GROQ_API_KEY_2 }}
        GROQ_API_KEY_3: ${{ secrets.GROQ_API_KEY_3 }}
        GROQ_API_KEY_4: ${{ secrets.GROQ_API_KEY_4 }}
        GROQ_API_KEY_5: ${{ secrets.GROQ_API_KEY_5 }}
        GROQ_API_KEY_6: ${{ secrets.GROQ_API_KEY_6 }}
        GROQ_API_KEY_7: ${{ secrets.GROQ_API_KEY_7 }}
        
        # --- áˆŒáˆá‰½ AI áŠ á‰…áˆ«á‰¢á‹á‰½ ---
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}

        # --- á‹¨áˆ›áˆ…á‰ áˆ«á‹Š áˆšá‹²á‹« á‰áˆáá‰½ ---
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
        FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
        LINKEDIN_TOKEN: ${{ secrets.LINKEDIN_TOKEN }}
        LINKEDIN_URN: ${{ secrets.LINKEDIN_URN }}
        
        # --- áŠ áŒ á‰ƒáˆ‹á‹­ á‹á‰…áˆ¨á‰µ ---
        ENTERPRISE_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        INPUT_TOPIC: ${{ github.event.inputs.topic || 'Future of Global Wealth and AI 2026' }}
        GITHUB_ACTIONS: "true"
        PYTHONPATH: .
        PYTHONUNBUFFERED: 1
      run: |
        echo "ğŸš€ Starting TITAN v22.0 Sovereign Engine..."
        # áˆ«áŠáˆ©áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ - á‹¨ 10 á‰áŒ¥áˆ­ áˆáˆ­áŒ«áŠ• (Mega-Production) áŠ¥áŠ“ áˆ­á‹•áˆµáŠ• á‰ áˆ«áˆµ áˆ°áˆ­ á‹­áˆáŠ«áˆ
        python main.py <<EOF
        10
        $INPUT_TOPIC
        EOF

    # 6. á‹¨áˆªá–áˆ­á‰µ áˆ›áŒ á‰ƒáˆˆá‹« áˆˆ GitHub Issues áˆ˜áˆ‹áŠ­ (á‹¨áŠ¥áˆ­áˆµá‹ á‰¦áˆ­á‹µ)
    - name: ğŸ“Š Update GitHub Enterprise Dashboard
      if: success()
      run: |
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
        TOPIC="${{ github.event.inputs.topic || 'Automated Scheduled Run' }}"
        
        curl -X POST \
          -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          -d "{\"title\": \"âœ… Production Complete: $TOPIC\", \"body\": \"### ğŸ‘‘ Sovereign Production Summary\n- **Status:** Successfully Generated & Distributed\n- **Execution Time:** $TIMESTAMP\n\nCheck `enterprise_outputs` for full reports.\"}" \
          "https://api.github.com/repos/${{ github.repository }}/issues"

    # 7. áŠ á‹³á‹²áˆµ á‹á‹­áˆá‰½áŠ• á‹ˆá‹° áˆªá–á‹šá‰¶áˆª áˆ˜áˆ˜áˆˆáˆµ (Auto-Push)
    - name: ğŸ“¤ Sync & Push to GitHub
      if: always()
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Sovereign-Bot ğŸ‘‘"
        
        # áŠ áˆµáˆáˆ‹áŒŠ á‹¨áˆ†áŠ‘ ááˆá‹°áˆ®á‰½ áˆ˜áŠ–áˆ«á‰¸á‹áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
        mkdir -p enterprise_outputs production_backups enterprise_logs ai_usage_logs
        
        git add .
        
        if git diff --staged --quiet; then
          echo "ğŸš« No changes to commit."
        else
          echo "âœ… New files detected. Syncing with remote..."
          git commit -m "ğŸ‘‘ Sovereign Output: [Run ${{ github.run_number }}]"
          git pull --rebase origin main
          git push origin main
        fi

    # 8. áŠ áˆ­á‰²á‹áŠ­á‰¶á‰½áŠ• áˆ›áˆµá‰€áˆ˜áŒ¥ (áˆˆáˆ›á‹áˆ¨á‹µ áŠ¥áŠ•á‹²áˆ˜á‰½)
    - name: ğŸ’¾ Archive Production Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: sovereign-final-results-v22
        retention-days: 30
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
