name: ğŸš€ Profit Master Elite - PRODUCTION RUN & DISTRIBUTE ON

on:
  workflow_dispatch:
    inputs:
      topic:
        description: 'á‹¨á‹­á‹˜á‰± áˆ­á‹•áˆµ (Content Topic)'
        required: false
        default: 'Enterprise AI Implementation Strategies 2026'
  schedule:
    - cron: '0 6 * * *' # á‰ á‹¨á‰€áŠ‘ áŒ á‹‹á‰µ 12:00 (6:00 UTC) á‹­áŠáˆ³áˆ

permissions:
  contents: write # áˆˆ Git Push á‹¨áŒá‹µ áŠ áˆµáˆáˆ‹áŒŠ áŠá‹

jobs:
  run-profit-machine:
    name: ğŸ­ Run, Publish & Notify
    runs-on: ubuntu-latest
    
    services:
      redis:
        image: redis
        ports:
          - 6379:6379

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: ğŸ¥ Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg

    - name: ğŸ“¦ Install Python Libraries
      run: |
        python -m pip install --upgrade pip
        # áˆˆ WordPress áŠ¥áŠ“ Telegram á‹ˆáˆ³áŠ á‹¨áˆ†áŠ‘á‰µ áŠ¥á‹šáˆ… á‰°áŒ¨áˆáˆ¨á‹‹áˆ
        pip install requests psutil python-dotenv pyyaml 
        pip install google-generativeai groq
        pip install beautifulsoup4 pandas jinja2
        # WordPress áˆˆáˆ˜áˆ‹áŠ­ (REST API á‹¨áˆáŠ•áŒ á‰€áˆ áŠ¨áˆ†áŠ requests á‰ á‰‚ áŠá‹á£ áŒáŠ• á‹­áˆ…áŠ•áŠ•áˆ áŠ¥áŠ•áŒ¨áˆáˆ­)
        pip install python-wordpress-xmlrpc

    - name: ğŸš€ Run Enterprise Engine
      env:
        # AI Keys
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        
        # Social Media & Web Keys (áˆˆá“á‹­á‰°áŠ• áˆµáŠ­áˆªá•á‰± áŠ¥áŠ•á‹²á‹°áˆ­áˆµ)
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        
        # System Config
        PYTHONPATH: .
      run: |
        echo "ğŸ”¥ Starting Enterprise Production..."
        # áˆµáŠ­áˆªá•á‰µáˆ… 'enterprise_runner.py' á‹ˆá‹­áˆ 'main_runner.py' áˆ˜áˆ†áŠ‘áŠ• áŠ áˆ¨áŒ‹áŒáŒ¥
        python enterprise_runner.py

    - name: ğŸ“¤ Deploy to GitHub Dashboard (Commit & Push)
      if: success() # áˆµáŠ­áˆªá•á‰± áŠ¨áˆ°áˆ« á‰¥á‰» áŠá‹ á‹¨áˆšáŒˆá‹á‹
      run: |
        git config --local user.email "bot@auto-money-maker.com"
        git config --local user.name "Profit Master Bot"
        
        # áŠ á‹³á‹²áˆµ á‹á‹­áˆá‰½áŠ• áŒ¨áˆáˆ­ (enterprise_outputs ááˆá‹°áˆ­áŠ• áŒ¨áˆáˆ®)
        git add enterprise_outputs/ production_backups/ ai_usage_logs/ || true
        
        # áˆˆá‹áŒ¥ áŠ«áˆˆ á‰¥á‰» Commit áŠ á‹µáˆ­áŒ
        if git diff --staged --quiet; then
          echo "Changes detected, pushing to repo..."
          git commit -m "ğŸš€ Auto-Publish: New Content & Reports [${{ github.run_id }}]"
          git pull --rebase origin main # áŒáŒ­á‰µ áŠ¥áŠ•á‹³á‹­áˆáŒ áˆ­ áˆ˜áŒ€áˆ˜áˆªá‹« áˆ³á‰¥
          git push origin main
        else
          echo "No changes to commit."
        fi

    - name: ğŸ“± Send Telegram Notification (Backup Action)
      # á“á‹­á‰°áŠ• áˆµáŠ­áˆªá•á‰± á‰ áˆ«áˆ± áŠ«áˆáˆ‹áŠ¨á£ á‹­áˆ… áŠ¥áŠ•á‹° áˆáˆˆá‰°áŠ› áŠ áˆ›áˆ«áŒ­ á‹­áˆ áˆ«áˆ
      if: always()
      uses: appleboy/telegram-action@master
      with:
        to: ${{ secrets.TELEGRAM_CHAT_ID }}
        token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        message: |
          âœ… GitHub Action Completed!
          
          Status: ${{ job.status }}
          Topic: ${{ github.event.inputs.topic }}
          Check repo for new files.

    - name: ğŸ’¾ Upload Artifacts (Downloadable Zip)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: enterprise-results
        path: |
          enterprise_outputs/
          enterprise_logs/
