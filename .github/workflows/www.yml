name: ğŸš€ Profit Master Elite - ULTIMATE PRODUCTION

on:
  # 1. á‰ áŠ¥áŒ… áˆ›áˆµáŒ€áˆ˜áˆ­ (áˆ­á‹•áˆµ áˆ˜áˆµáŒ á‰µ á‹­á‰»áˆ‹áˆ)
  workflow_dispatch:
    inputs:
      topic:
        description: 'Target Topic (e.g., Enterprise AI 2026)'
        required: false
        default: 'Enterprise AI Implementation Strategies 2026'
      
  # 2. á‰ á‹¨á‰€áŠ‘ áŒ á‹‹á‰µ 12:00 (6:00 UTC) á‰ áˆ«áˆµ áˆ°áˆ­ á‹­áŠáˆ³áˆ
  schedule:
    - cron: '0 6 * * *'

# ğŸ” á‰¦á‰± á‹ˆá‹° áˆªá–áˆ… á‹á‹­áˆ áˆ˜áŒ»á áŠ¥áŠ•á‹²á‰½áˆ áˆá‰ƒá‹µ
permissions:
  contents: write
  actions: read

jobs:
  run-enterprise-engine:
    name: ğŸ­ Run Enterprise Engine
    runs-on: ubuntu-latest
    timeout-minutes: 60 # áŠ¨1 áˆ°á‹“á‰µ á‰ áˆ‹á‹­ áŠ¨áˆáŒ€ á‰ áŒá‹µ á‹«á‰†áˆ˜á‹‹áˆ (áŒˆáŠ•á‹˜á‰¥/Time áˆˆáˆ˜á‰†áŒ á‰¥)

    steps:
    # 1. áŠ®á‹±áŠ• áˆ›á‹áˆ¨á‹µ
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # áˆ™áˆ‰ á‹¨ Git á‰³áˆªáŠ­ á‹«áˆµáˆáˆáŒˆáŠ“áˆ (áˆˆ Push)

    # 2. á“á‹­á‰°áŠ• áˆ›á‹˜áŒ‹áŒ€á‰µ
    - name: ğŸ Set up Python 3.10
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip' # á‹¨áˆ‹á‹­á‰¥áˆ¨áˆª á‰…áŒ‚ (Cache) á‹­áŒ á‰€áˆ›áˆ (áˆˆááŒ¥áŠá‰µ)

    # 3. á‹¨áˆ²áˆµá‰°áˆ áˆ¶áá‰µá‹Œáˆ®á‰½ (áˆˆ Video/Audio)
    - name: ğŸ¥ Install System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg

    # 4. á“á‹­á‰°áŠ• áˆ‹á‹­á‰¥áˆ¨áˆªá‹á‰½ (áˆáˆ‰áŠ•áˆ áŠ áˆµáˆáˆ‹áŒŠ áŠáŒˆáˆ®á‰½ á‹¨á‹«á‹˜)
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests psutil python-dotenv pyyaml
        pip install google-generativeai groq openai
        pip install beautifulsoup4 pandas jinja2 lxml
        pip install python-wordpress-xmlrpc
        # áˆˆá‰°áŒ¨áˆ›áˆª áŒ¥áŠ•á‰ƒá‰„
        pip install aiohttp asyncio

    # 5. áˆµáˆ«á‹áŠ• áˆ›áˆµáŒ€áˆ˜áˆ­ (The Main Engine)
    - name: ğŸš€ Execute Enterprise Runner
      env:
        # AI API Keys
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }} # áŠ«áˆˆáˆ…
        AI_CULTURAL_API_KEY: ${{ secrets.AI_CULTURAL_API_KEY }}
        AI_AUDIT_API_KEY: ${{ secrets.AI_AUDIT_API_KEY }}
        AI_TITLE_API_KEY: ${{ secrets.AI_TITLE_API_KEY }}
        
        # Social Media & Web
        WP_URL: ${{ secrets.WP_URL }}
        WP_USERNAME: ${{ secrets.WP_USERNAME }}
        WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        
        # Topic Input (áŠ¨áˆ‹á‹­ áŠ¨á‰°áˆ°áŒ á‹ á‹ˆá‹­áˆ Default)
        ENTERPRISE_TOPIC: ${{ github.event.inputs.topic || 'Enterprise AI Implementation Strategies 2026' }}
        
        # System
        PYTHONPATH: .
      run: |
        echo "ğŸ”¥ Starting Production Engine for topic: $ENTERPRISE_TOPIC"
        # áˆµáŠ­áˆªá•á‰± áˆµáˆ…á‰°á‰µ á‰¢áˆáŒ¥áˆ­áˆ áˆ‚á‹°á‰± áŠ¥áŠ•á‹³á‹­á‰‹áˆ¨áŒ¥ (set +e)
        set +e 
        python enterprise_runner.py
        exit_code=$?
        if [ $exit_code -ne 0 ]; then
          echo "âš ï¸ Script finished with warnings or errors (Code: $exit_code)"
          # áˆµáŠ­áˆªá•á‰± á‰¢á‹ˆá‹µá‰…áˆ Artifacts áŠ¥áŠ•á‹²áˆ°á‰ áˆ°á‰¥ áŠ¥á‹šáˆ… áŒ‹áˆ­ áŠ áŠ•á‹ˆáŒ£áˆ
        else
          echo "âœ… Script finished successfully"
        fi

    # 6. á‹áŒ¤á‰±áŠ• á‹ˆá‹° GitHub áˆ˜áˆáˆ¶ áˆ˜áŒ«áŠ• (Commit & Push)
    - name: ğŸ“¤ Commit & Push Results
      if: always() # áˆµáŠ­áˆªá•á‰± á‰¢á‰ áˆ‹áˆ½áˆ á‹¨á‰°áˆ°áˆ«á‹áŠ• á‹­áŒ«áŠ•
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "Enterprise Bot ğŸ¤–"
        
        # áŠ á‹³á‹²áˆµ ááˆá‹°áˆ®á‰½áŠ• áŒ¨áˆáˆ­
        git add enterprise_outputs/ production_backups/ enterprise_logs/ ai_usage_logs/ || true
        
        # áˆˆá‹áŒ¥ áŠ«áˆˆ áŠ¥á‹­
        if git diff --staged --quiet; then
          echo "ğŸš« No changes to commit."
        else
          echo "âœ… Changes detected. Committing..."
          git commit -m "ğŸš€ Enterprise Output: ${{ github.event.inputs.topic || 'Daily Run' }} [${{ github.run_id }}]"
          
          # áŒáŒ­á‰µ áŠ¥áŠ•á‹³á‹­áˆáŒ áˆ­ áˆ˜áŒ€áˆ˜áˆªá‹« áˆ³á‰¥ (Rebase), áŠ¨á‹› áŒ«áŠ• (Push)
          git pull --rebase origin main
          git push origin main
        fi

    # 7. á‹á‹­áˆá‰¹áŠ• áˆˆá‹³á‹áˆá‹µ áˆ›á‹˜áŒ‹áŒ€á‰µ (Artifacts)
    - name: ğŸ’¾ Upload Artifacts (Zip)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: enterprise-production-results
        retention-days: 90
        path: |
          enterprise_outputs/
          enterprise_logs/
          production_backups/
          *.html
          *.json
          *.md
