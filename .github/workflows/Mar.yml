name: üöÄ Profit Master Supreme - MEGA 7000+ AUTOMATION

on:
  schedule:
    - cron: '0 */6 * * *' # ·â†·ã® 6 ·à∞·ãì·â± ·ä†·ãç·â∂·àõ·â≤·ä≠ ·ã≠·à∞·à´·àç
  workflow_dispatch:
    inputs:
      topic:
        description: '·ã®·ã≠·ãò·âµ ·à≠·ãï·àµ (Topic)'
        required: false
        default: 'High-Ticket Affiliate Marketing Strategies 2026'
      language:
        description: '·âã·äï·âã (am/en)'
        required: false
        default: 'en'

permissions:
  contents: write
  issues: write

jobs:
  run_profit_master:
    name: "üöÄ Run Mega Profit Machine & Distribute"
    runs-on: ubuntu-latest
    
    steps:
      - name: "üì• Checkout Repository"
        uses: actions/checkout@v4

      - name: "üêç Setup Python 3.12"
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: "üîß Install System Dependencies"
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: "üì¶ Install ALL Python Libraries"
        run: |
          python -m pip install --upgrade pip
          pip install \
            aiohttp httpx requests pandas numpy schedule \
            groq google-generativeai openai anthropic cohere \
            gtts "moviepy>=2.0.0" yt-dlp Pillow \
            beautifulsoup4 selenium tweepy \
            sqlalchemy redis fastapi uvicorn psutil \
            nltk spacy textblob "pydantic>=2.0" tenacity prometheus-client boto3 \
            deep-translator transformers
          python -m nltk.downloader punkt stopwords wordnet averaged_perceptron_tagger_eng

      - name: "ü§ñ Execute Mega-Production & Social Posting"
        env:
          # --- AI API KEYS ---
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
          
          # --- GROQ KEYS ROTATION ---
          GROQ_API_KEY_1: ${{ secrets.GROQ_API_KEY_1 }}
          GROQ_API_KEY_2: ${{ secrets.GROQ_API_KEY_2 }}
          GROQ_API_KEY_3: ${{ secrets.GROQ_API_KEY_3 }}
          GROQ_API_KEY_4: ${{ secrets.GROQ_API_KEY_4 }}
          GROQ_API_KEY_5: ${{ secrets.GROQ_API_KEY_5 }}
          GROQ_API_KEY_6: ${{ secrets.GROQ_API_KEY_6 }}
          GROQ_API_KEY_7: ${{ secrets.GROQ_API_KEY_7 }}

          # --- SOCIAL MEDIA & CMS KEYS ---
          WP_URL: ${{ secrets.WP_URL }}
          WP_USERNAME: ${{ secrets.WP_USERNAME }}
          WP_PASSWORD: ${{ secrets.WP_PASSWORD }}
          
          FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
          FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
          
          TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
          TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_SECRET: ${{ secrets.TWITTER_ACCESS_SECRET }}
          
          LINKEDIN_TOKEN: ${{ secrets.LINKEDIN_TOKEN }}
          LINKEDIN_URN: ${{ secrets.LINKEDIN_URN }}
          
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

          # --- SYSTEM CONFIG ---
          GITHUB_ACTIONS: "true"
          INPUT_TOPIC: ${{ github.event.inputs.topic || 'High-Ticket Affiliate Marketing Strategies 2026' }}
          INPUT_LANGUAGE: ${{ github.event.inputs.language || 'en' }}
          PYTHONUNBUFFERED: 1
        run: |
          echo "üöÄ Starting automated Mega-Production and Multi-Channel Distribution..."
          
          # '10' ·àà Mega-Production ·àù·à≠·å´ ·äê·ãç
          if [ -f "enterprise_production_runner.py" ]; then
             echo "10" | python enterprise_production_runner.py
          elif [ -f "main.py" ]; then
             echo "10" | python main.py
          else
             echo "‚ùå Error: Required script not found!"
             exit 1
          fi

      - name: "üìù Create GitHub Issue Summary"
        if: success()
        run: |
          # ·ã®·â∞·àò·à®·â∞·ãç·äï ·ãç·å§·âµ ·àõ·å†·âÉ·àà·ã´ ·â† GitHub Board (Issues) ·àã·ã≠ ·ã≠·àà·å•·çã·àç
          curl -X POST \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -d "{\"title\": \"Production Complete: ${{ github.event.inputs.topic }}\", \"body\": \"Automated production finished successfully. Check outputs folder for 11 country reports.\"}" \
            "https://api.github.com/repos/${{ github.repository }}/issues"

      - name: "üíæ Commit & Push Results (Bulletproof)"
        if: always()
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Action"
          git add outputs/ logs/ enterprise_outputs/ || true
          
          if git diff --quiet && git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "üöÄ Automated Mega-Content & Social Posting [v8.2]"
            git pull --rebase origin main
            git push origin main
          fi
