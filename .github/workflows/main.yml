name: ğŸ† Profit Machine Ultimate

on:
  schedule:
    # 24/7 Automation - runs every 6 hours
    - cron: '0 */6 * * *'
  
  workflow_dispatch:
    inputs:
      workflow_type:
        description: 'Select workflow type'
        required: true
        default: 'daily'
        type: choice
        options:
        - daily
        - v10_only
        - v11_only
        - test
        - emergency_stop
      content_count:
        description: 'Number of content pieces'
        required: false
        default: '1'
        type: string

env:
  PYTHON_VERSION: '3.10'
  
jobs:
  setup-environment:
    name: âš™ï¸ Setup Environment
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python ${{ env.PYTHON_VERSION }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ”§ Create Environment File
      run: |
        echo "GROQ_API_KEY=${{ secrets.GROQ_API_KEY }}" >> .env
        echo "WP_URL=${{ secrets.WP_URL }}" >> .env
        echo "WP_USERNAME=${{ secrets.WP_USERNAME }}" >> .env
        echo "WP_PASSWORD=${{ secrets.WP_PASSWORD }}" >> .env
        echo "TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}" >> .env
        echo "TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}" >> .env
        echo "MASTER_MODE=auto" >> .env
        echo "HYBRID_STRATEGY=quality_first" >> .env
        
    - name: ğŸ“ Create Required Directories
      run: |
        mkdir -p logs exports data backups
        
  run-v10-factory:
    name: ğŸ­ V10 Content Factory
    runs-on: ubuntu-latest
    needs: setup-environment
    if: ${{ github.event.inputs.workflow_type != 'v11_only' && github.event.inputs.workflow_type != 'emergency_stop' }}
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ”§ Load Environment
      run: |
        echo "GROQ_API_KEY=${{ secrets.GROQ_API_KEY }}" >> .env
        echo "WP_URL=${{ secrets.WP_URL }}" >> .env
        echo "WP_USERNAME=${{ secrets.WP_USERNAME }}" >> .env
        echo "WP_PASSWORD=${{ secrets.WP_PASSWORD }}" >> .env
        
    - name: ğŸš€ Run V10 Engine
      id: v10_run
      run: |
        echo "Starting V10 Content Factory..."
        # Replace with actual V10 execution command
        python v10/main.py --mode auto --count ${{ github.event.inputs.content_count || '1' }}
        echo "v10_status=completed" >> $GITHUB_OUTPUT
        
    - name: ğŸ“Š Export Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: v10-exports
        path: exports/v10/
        retention-days: 7
        
    - name: ğŸ“‹ Log Summary
      if: always()
      run: |
        echo "V10 Execution Summary:"
        echo "Timestamp: $(date)"
        echo "Workflow: ${{ github.event.inputs.workflow_type }}"
        echo "Status: ${{ steps.v10_run.outcome }}"
        
  run-v11-godmode:
    name: âš¡ V11 GOD MODE
    runs-on: ubuntu-latest
    needs: [setup-environment, run-v10-factory]
    if: ${{ github.event.inputs.workflow_type != 'v10_only' && github.event.inputs.workflow_type != 'emergency_stop' }}
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ“¥ Download V10 Outputs
      uses: actions/download-artifact@v4
      with:
        name: v10-exports
        path: exports/v10/
        
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ”§ Load Environment
      run: |
        echo "GROQ_API_KEY=${{ secrets.GROQ_API_KEY }}" >> .env
        echo "TELEGRAM_BOT_TOKEN=${{ secrets.TELEGRAM_BOT_TOKEN }}" >> .env
        echo "TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }}" >> .env
        
    - name: ğŸš€ Run V11 Enhancement
      id: v11_run
      run: |
        echo "Starting V11 GOD MODE Enhancement..."
        # Replace with actual V11 execution command
        python v11/main.py --mode quality_control --input exports/v10/
        echo "v11_status=completed" >> $GITHUB_OUTPUT
        
    - name: ğŸ“Š Export Enhanced Content
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: v11-exports
        path: exports/v11/
        retention-days: 7
        
  master-controller:
    name: ğŸ›ï¸ Master Controller
    runs-on: ubuntu-latest
    needs: [run-v10-factory, run-v11-godmode]
    if: ${{ github.event.inputs.workflow_type != 'emergency_stop' }}
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ“¥ Download All Artifacts
      uses: actions/download-artifact@v4
      with:
        path: all-exports/
        
    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ğŸ¯ Run Master Controller
      run: |
        echo "Running Master Controller..."
        python main_controller.py --workflow ${{ github.event.inputs.workflow_type }}
        
    - name: ğŸ“¤ Upload Database
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: profit-machine-database
        path: data/*.db
        retention-days: 30
        
  notifications:
    name: ğŸ“¢ Send Notifications
    runs-on: ubuntu-latest
    needs: [master-controller]
    if: always()
    
    steps:
    - name: ğŸ“Š Workflow Status
      id: status_check
      run: |
        if [ "${{ needs.master-controller.result }}" = "success" ]; then
          echo "status=âœ… SUCCESS" >> $GITHUB_OUTPUT
          echo "message=Profit Machine completed successfully!" >> $GITHUB_OUTPUT
        else
          echo "status=âŒ FAILED" >> $GITHUB_OUTPUT
          echo "message=Profit Machine encountered errors!" >> $GITHUB_OUTPUT
        fi
        
    - name: ğŸ“¨ Send Telegram Notification
      if: ${{ secrets.TELEGRAM_BOT_TOKEN != '' }}
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="ğŸ† Profit Machine Status: ${{ steps.status_check.outputs.status }}
        
        ğŸ“‹ Workflow: ${{ github.event.inputs.workflow_type || 'daily' }}
        â° Time: $(date)
        ğŸ”— Run URL: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
        
        ${{ steps.status_check.outputs.message }}"
        
  emergency-cleanup:
    name: ğŸš¨ Emergency Cleanup
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.workflow_type == 'emergency_stop' }}
    
    steps:
    - name: ğŸ›‘ Stop All Processes
      run: |
        echo "EMERGENCY STOP ACTIVATED!"
        echo "All Profit Machine processes terminated."
        # Add cleanup commands here
        echo "Cleanup completed at $(date)"
        
    - name: ğŸ“¢ Send Emergency Alert
      if: ${{ secrets.TELEGRAM_BOT_TOKEN != '' }}
      run: |
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d text="ğŸš¨ EMERGENCY STOP ACTIVATED!
          
          Profit Machine has been manually stopped.
          Time: $(date)
          Triggered by: ${{ github.actor }}"
