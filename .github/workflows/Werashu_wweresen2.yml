name: Profit Master Supreme v12.1 - Final Optimized Version

on:
  workflow_dispatch:
    inputs:
      action_type:
        description: 'á‹¨áˆ›áˆµáŠ¬á‹µ áŠ á‹­áŠá‰µ'
        required: true
        default: 'full_cycle'
        type: choice
        options:
          - content_generation
          - monetization_update
          - social_posting
          - analytics_report
          - full_cycle
          - emergency_recovery
      intensity:
        description: 'á‹¨áˆ›áˆµáŠ¬á‹µ áŒ¥áŠ•áŠ«áˆ¬'
        required: false
        default: 'aggressive'
        type: choice
        options:
          - light
          - standard
          - aggressive
          - extreme

  # á‰€áˆˆáˆ á‹«áˆˆ á‹¨áˆ°áŠ á‰µ áˆ›áˆµá‰°áŠ«áŠ¨á‹« (á‹¨á‹‹áŒ‹ á‰…áŠáˆ³)
  schedule:
    - cron: '0 */6 * * *'    # á‰ á‹¨6 áˆ°á‹“á‰±
    - cron: '30 12 * * *'    # á‰ á‹¨á‰€áŠ‘ á‰ 12:30

# ğŸ”‘ á‹¨áˆµáˆœá‰µ áˆá‰ƒá‹¶á‰½ (áŠ¥áŠá‹šáˆ… áˆáŠ•áˆ áŠáŒˆáˆ­ áˆ³á‹­áˆ áˆ« á‹«á‹°áˆ­áŒ‹áˆ‰!)
permissions:
  contents: write
  pages: write
  id-token: write
  actions: read

env:
  PYTHON_VERSION: '3.10'
  DATABASE_FILE: 'profit_master.db'
  OUTPUT_DIR: 'public'
  TELEGRAM_API_URL: 'https://api.telegram.org/bot'

jobs:
  # ==================== á‹°áˆ¨áŒƒ 1: áˆµáˆ­á‹“á‰µ áˆ›áˆµáŠáˆ» áŠ¥áŠ“ áˆ˜áˆ°áˆ¨á‰³á‹Š áˆ›á‹‹á‰€áˆ­ ====================
  system_setup:
    runs-on: ubuntu-latest
    name: "ğŸ”§ áˆµáˆ­á‹“á‰µ áˆ›áˆµáŠáˆ» áŠ¥áŠ“ áˆ˜áˆ°áˆ¨á‰³á‹Š áˆ›á‹‹á‰€áˆ­"
    outputs:
      session_id: ${{ steps.generate_session.outputs.session_id }}
    
    steps:
      - name: "ğŸ“¥ áŠ®á‹µ áˆ›á‹áˆ¨á‹µ"
        uses: actions/checkout@v4

      - name: "ğŸ Python áˆ›á‹‹á‰€áˆ­"
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'

      - name: "ğŸ“¦ á‹¨á“á‹­á‰°áŠ• á“áŠ¬áŒ†á‰½ áˆ˜áŒ«áŠ•"
        run: |
          pip install --upgrade pip
          pip install sqlite3 pandas numpy requests
          pip install schedule python-dotenv
          pip install matplotlib seaborn
          pip install python-telegram-bot
          echo "âœ… Python packages installed"

      - name: "ğŸ†” á‹¨áˆµáˆ­á‹“á‰µ áˆ›áˆµáŠáˆ» áˆ˜áˆˆá‹« áˆ›áˆ˜áŠ•áŒ¨á‰µ"
        id: generate_session
        run: |
          SESSION_ID="PM_$(date +%Y%m%d%H%M%S)_${{ github.run_id }}_$(openssl rand -hex 3)"
          echo "session_id=$SESSION_ID" >> $GITHUB_OUTPUT
          echo "âœ… Session ID generated: $SESSION_ID"

      - name: "ğŸ—„ï¸ á‹¨á‹áˆ‚á‰¥ áŒá‰³ áŠ¥áŠ“ á‹¨á‹áŒ¤á‰µ áˆ›á‹áŒ« áˆ˜ááŒ áˆ­"
        run: |
          # á‹¨á‹áŒ¤á‰µ áˆ›á‹áŒ« áˆ˜ááŒ áˆ­
          mkdir -p ${{ env.OUTPUT_DIR }}
          
          # á‹¨á‹áˆ‚á‰¥ áŒá‰³ áˆ˜ááŒ áˆ­ áŠ¥áŠ“ áˆ˜áˆ°áˆ¨á‰³á‹Š áˆ›á‹‹á‰€áˆ­
          python3 << 'EOF'
import sqlite3, json, os
from datetime import datetime

db_path = os.environ.get('DATABASE_FILE', 'profit_master.db')
output_dir = os.environ.get('OUTPUT_DIR', 'public')

# á‹¨á‹áˆ‚á‰¥ áŒá‰³ áˆ˜ááŒ áˆ­
conn = sqlite3.connect(db_path)
cursor = conn.cursor()

# áˆ˜áˆ°áˆ¨á‰³á‹Š áˆ°áŠ•áŒ áˆ¨á‹¦á‰½áŠ• áˆ˜ááŒ áˆ­
cursor.execute('''
CREATE TABLE IF NOT EXISTS system_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT,
    event_type TEXT,
    message TEXT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS content_items (
    id TEXT PRIMARY KEY,
    title TEXT,
    content_type TEXT,
    word_count INTEGER,
    quality_score INTEGER,
    created_at DATETIME,
    monetization_potential REAL
)
''')

cursor.execute('''
CREATE TABLE IF NOT EXISTS revenue_events (
    id TEXT PRIMARY KEY,
    source TEXT,
    amount REAL,
    event_date DATE,
    platform TEXT,
    session_id TEXT
)
''')

# á‹¨áˆ™áŠ¨áˆ« á‹áˆ‚á‰¥ áˆ›áˆµáŒˆá‰£á‰µ
test_data = [
    ('system_start', 'System initialized successfully', datetime.now().isoformat()),
    ('database_created', 'Database tables created', datetime.now().isoformat()),
    ('environment_ready', 'Python environment configured', datetime.now().isoformat())
]

for event_type, message, timestamp in test_data:
    cursor.execute(
        "INSERT INTO system_logs (event_type, message, timestamp) VALUES (?, ?, ?)",
        (event_type, message, timestamp)
    )

conn.commit()
conn.close()

print(f"âœ… Database created at {db_path}")
print(f"âœ… Output directory created: {output_dir}")

# á‹¨áˆµáˆ­á‹“á‰µ áˆ˜áˆ¨áŒƒ á‹á‹­áˆ áˆ˜ááŒ áˆ­
system_info = {
    "version": "12.1.0",
    "session_id": os.environ.get('SESSION_ID', 'unknown'),
    "boot_time": datetime.now().isoformat(),
    "database": db_path,
    "output_directory": output_dir,
    "python_version": os.environ.get('PYTHON_VERSION', '3.10')
}

with open(f'{output_dir}/system_info.json', 'w') as f:
    json.dump(system_info, f, indent=2)

print("âœ… System info file created")
EOF

      - name: "ğŸ“¤ á‹¨áˆµáˆ­á‹“á‰µ áˆ˜áˆ¨áŒƒ áˆ›áˆµá‰€áˆ˜áŒ¥"
        uses: actions/upload-artifact@v4
        with:
          name: system-data
          path: |
            ${{ env.DATABASE_FILE }}
            ${{ env.OUTPUT_DIR }}/
          retention-days: 7

  # ==================== á‹°áˆ¨áŒƒ 2: á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ¨á‰µ áŠ¥áŠ“ á‰µáŠ•á‰°áŠ“ ====================
  content_generation:
    runs-on: ubuntu-latest
    needs: system_setup
    name: "ğŸ§  á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ¨á‰µ áŠ¥áŠ“ á‰µáŠ•á‰°áŠ“"
    
    steps:
      - name: "ğŸ“¥ á‹¨áˆµáˆ­á‹“á‰µ áˆ˜áˆ¨áŒƒ áˆ›á‹áˆ¨á‹µ"
        uses: actions/download-artifact@v4
        with:
          name: system-data
          path: .

      - name: "ğŸ á‹¨á“á‹­á‰°áŠ• á“áŠ¬áŒ†á‰½ áˆ˜áŒ«áŠ• (áŠ¥áŠ•á‹°áŒˆáŠ“)"
        run: |
          pip install --upgrade pip
          pip install pandas numpy
          echo "âœ… Python packages installed for content generation"

      - name: "ğŸ“ á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ« áˆáŒáˆ áˆ˜ááŒ áˆ­"
        run: |
          cat > content_generator.py << 'EOF'
import sqlite3, json, random, datetime, os
import pandas as pd

class ContentGenerator:
    def __init__(self, db_path, output_dir):
        self.db_path = db_path
        self.output_dir = output_dir
        self.conn = sqlite3.connect(db_path)
        
        # á‹¨á‹­á‹˜á‰µ áŠ á‹­áŠá‰¶á‰½
        self.content_types = [
            'blog_post', 'product_review', 'how_to_guide',
            'case_study', 'list_article', 'tutorial'
        ]
        
        # á‹¨áˆ­á‹•áˆµ áˆ­áŠ¥áˆ¶á‰½
        self.topics = [
            "AI Monetization Strategies",
            "Passive Income with Automation",
            "Affiliate Marketing Optimization",
            "Social Media Growth Hacking",
            "SEO Content Creation"
        ]
    
    def generate_content(self, count=10):
        """á‹¨á‹­á‹˜á‰µ áˆá‹µá‰¦á‰½áŠ• áˆ›áˆ˜áŠ•áŒ¨á‰µ"""
        content_items = []
        
        for i in range(count):
            content_type = random.choice(self.content_types)
            topic = random.choice(self.topics)
            
            content = {
                'id': f"content_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}_{i}",
                'title': f"{topic} - Complete Guide {i+1}",
                'content_type': content_type,
                'word_count': random.randint(800, 3000),
                'quality_score': random.randint(70, 98),
                'created_at': datetime.datetime.now().isoformat(),
                'monetization_potential': round(random.uniform(10, 500), 2),
                'keywords': [topic.lower(), content_type, 'guide', '2024'],
                'estimated_read_time': f"{random.randint(3, 15)} minutes"
            }
            
            content_items.append(content)
            
            # á‹ˆá‹° á‹áˆ‚á‰¥ áŒá‰³ áˆ›áˆµá‰€áˆ˜áŒ¥
            self.save_to_database(content)
        
        return content_items
    
    def save_to_database(self, content):
        """á‹áˆ‚á‰¥ á‹ˆá‹° á‹áˆ‚á‰¥ áŒá‰³ áˆ›áˆµá‰€áˆ˜áŒ¥"""
        cursor = self.conn.cursor()
        cursor.execute('''
            INSERT OR REPLACE INTO content_items 
            (id, title, content_type, word_count, quality_score, created_at, monetization_potential)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        ''', (
            content['id'],
            content['title'],
            content['content_type'],
            content['word_count'],
            content['quality_score'],
            content['created_at'],
            content['monetization_potential']
        ))
        self.conn.commit()
    
    def analyze_content(self):
        """á‹¨á‹­á‹˜á‰µ á‰µáŠ•á‰°áŠ“"""
        df = pd.read_sql_query("SELECT * FROM content_items", self.conn)
        
        if df.empty:
            return {"error": "No content found"}
        
        analysis = {
            'total_content': len(df),
            'total_words': int(df['word_count'].sum()),
            'average_quality': float(df['quality_score'].mean()),
            'average_monetization': float(df['monetization_potential'].mean()),
            'by_content_type': df['content_type'].value_counts().to_dict(),
            'top_performing': self.get_top_performing(df)
        }
        
        return analysis
    
    def get_top_performing(self, df):
        """áˆáˆ­áŒ¥ á‹¨áˆ†áŠ‘ á‹­á‹˜á‰¶á‰½áŠ• áˆ˜áˆˆá‹¨á‰µ"""
        top = df.nlargest(3, 'monetization_potential')
        return top[['id', 'title', 'monetization_potential']].to_dict('records')
    
    def create_report(self):
        """áˆªá–áˆ­á‰µ áˆ˜ááŒ áˆ­"""
        content_items = self.generate_content(15)
        analysis = self.analyze_content()
        
        report = {
            'generated_at': datetime.datetime.now().isoformat(),
            'session_id': os.environ.get('SESSION_ID', 'unknown'),
            'content_summary': {
                'generated_count': len(content_items),
                'total_monetization_potential': sum(c['monetization_potential'] for c in content_items)
            },
            'analysis': analysis,
            'recommendations': [
                "Increase content frequency by 30%",
                "Focus on high-monetization content types",
                "Optimize for SEO with targeted keywords",
                "Repurpose content across multiple platforms"
            ]
        }
        
        return report
    
    def close(self):
        """áˆ˜áˆ¨áŒƒá‹á‰½áŠ• áˆ›áŒ á‹á‰µ"""
        self.conn.close()

def main():
    db_path = os.environ.get('DATABASE_FILE', 'profit_master.db')
    output_dir = os.environ.get('OUTPUT_DIR', 'public')
    
    generator = ContentGenerator(db_path, output_dir)
    
    try:
        # áˆªá–áˆ­á‰µ áˆ˜ááŒ áˆ­
        report = generator.create_report()
        
        # á‹ˆá‹° JSON á‹á‹­áˆ áˆ›áˆµá‰€áˆ˜áŒ¥
        report_file = f'{output_dir}/content_report.json'
        with open(report_file, 'w') as f:
            json.dump(report, f, indent=2)
        
        print(f"âœ… Content generation completed")
        print(f"ğŸ“Š Generated {report['content_summary']['generated_count']} content items")
        print(f"ğŸ’° Total monetization potential: ${report['content_summary']['total_monetization_potential']:.2f}")
        
        # á‹¨á‹­á‹˜á‰µ áˆªá–áˆ­á‰µ HTML áˆ˜ááŒ áˆ­
        create_html_report(report, output_dir)
        
    except Exception as e:
        print(f"âŒ Error in content generation: {e}")
    finally:
        generator.close()

def create_html_report(report, output_dir):
    """á‹¨HTML áˆªá–áˆ­á‰µ áˆ˜ááŒ áˆ­"""
    html_content = f"""
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Master Content Report</title>
    <style>
        body {{ font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }}
        .container {{ max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }}
        .header {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center; }}
        .stats {{ display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }}
        .stat-card {{ background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }}
        .stat-value {{ font-size: 2em; font-weight: bold; color: #333; }}
        .stat-label {{ color: #666; }}
        .recommendation {{ background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; border-radius: 4px; }}
        table {{ width: 100%; border-collapse: collapse; margin: 20px 0; }}
        th, td {{ padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }}
        th {{ background-color: #667eea; color: white; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Profit Master Content Report</h1>
            <p>Generated: {report['generated_at']}</p>
            <p>Session: {report['session_id']}</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value">{report['content_summary']['generated_count']}</div>
                <div class="stat-label">Content Items Generated</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${report['content_summary']['total_monetization_potential']:.2f}</div>
                <div class="stat-label">Total Monetization Potential</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{report['analysis']['average_quality']:.1f}/100</div>
                <div class="stat-label">Average Quality Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{report['analysis']['total_words']:,}</div>
                <div class="stat-label">Total Words Generated</div>
            </div>
        </div>
        
        <h2>ğŸ“ˆ Content Type Distribution</h2>
        <table>
            <tr><th>Content Type</th><th>Count</th></tr>
            {"".join(f"<tr><td>{ctype}</td><td>{count}</td></tr>" for ctype, count in report['analysis']['by_content_type'].items())}
        </table>
        
        <h2>ğŸ† Top Performing Content</h2>
        <table>
            <tr><th>Title</th><th>Monetization Potential</th></tr>
            {"".join(f"<tr><td>{item['title']}</td><td>${item['monetization_potential']:.2f}</td></tr>" for item in report['analysis']['top_performing'])}
        </table>
        
        <h2>ğŸ¯ Recommendations</h2>
        {"".join(f'<div class="recommendation">âœ… {rec}</div>' for rec in report['recommendations'])}
        
        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
            <p>Generated by Profit Master Supreme v12.1</p>
            <p>Next scheduled update: 6 hours</p>
        </div>
    </div>
</body>
</html>
"""
    
    # á‹‹áŠ“ index.html á‹á‹­áˆ áˆ˜ááŒ áˆ­
    with open(f'{output_dir}/index.html', 'w') as f:
        f.write(html_content)
    
    print("âœ… HTML report created at index.html")

if __name__ == "__main__":
    main()
EOF

      - name: "ğŸš€ á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ« áˆ›áˆµáŠ¬á‹µ"
        env:
          DATABASE_FILE: ${{ env.DATABASE_FILE }}
          OUTPUT_DIR: ${{ env.OUTPUT_DIR }}
          SESSION_ID: ${{ needs.system_setup.outputs.session_id }}
        run: python3 content_generator.py

      - name: "ğŸ“¤ á‹¨á‹­á‹˜á‰µ áˆ›áˆ˜áŠ•áŒ¨á‰µ á‹áŒ¤á‰¶á‰½ áˆ›áˆµá‰€áˆ˜áŒ¥"
        uses: actions/upload-artifact@v4
        with:
          name: content-results
          path: |
            ${{ env.DATABASE_FILE }}
            ${{ env.OUTPUT_DIR }}/
          retention-days: 7

  # ==================== á‹°áˆ¨áŒƒ 3: á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“ áŠ¥áŠ“ á‹³áˆ½á‰¦áˆ­á‹µ ====================
  revenue_analytics:
    runs-on: ubuntu-latest
    needs: content_generation
    name: "ğŸ’° á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“ áŠ¥áŠ“ á‹³áˆ½á‰¦áˆ­á‹µ"
    
    steps:
      - name: "ğŸ“¥ á‹¨á‹­á‹˜á‰µ á‹áŒ¤á‰¶á‰½ áˆ›á‹áˆ¨á‹µ"
        uses: actions/download-artifact@v4
        with:
          name: content-results
          path: .

      - name: "ğŸ“ˆ á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“ áˆáŒáˆ áˆ˜ááŒ áˆ­"
        run: |
          cat > revenue_analyzer.py << 'EOF'
import sqlite3, json, random, datetime, os
import pandas as pd
import matplotlib.pyplot as plt

class RevenueAnalyzer:
    def __init__(self, db_path, output_dir):
        self.db_path = db_path
        self.output_dir = output_dir
        self.conn = sqlite3.connect(db_path)
        
        # á‹¨áŒˆá‰¢ áˆáŠ•áŒ®á‰½
        self.revenue_sources = [
            'affiliate_marketing', 'advertising', 'sponsorships',
            'digital_products', 'consulting', 'membership'
        ]
        
        # á‹¨áˆ˜á‹µáˆ¨áŠ®á‰½
        self.platforms = ['website', 'youtube', 'twitter', 'linkedin', 'facebook', 'instagram']
    
    def generate_revenue_data(self, days=30):
        """á‹¨á‰³áˆªáŠ«á‹Š á‹¨áŒˆá‰¢ á‹áˆ‚á‰¥ áˆ›áˆ˜áŠ•áŒ¨á‰µ"""
        start_date = datetime.datetime.now() - datetime.timedelta(days=days)
        
        for i in range(days):
            current_date = start_date + datetime.timedelta(days=i)
            
            for _ in range(random.randint(2, 6)):  # 2-6 á‹¨áŒˆá‰¢ áŠ­áˆµá‰°á‰¶á‰½ á‰ á‰€áŠ•
                revenue_event = {
                    'id': f"rev_{current_date.strftime('%Y%m%d')}_{random.randint(1000, 9999)}",
                    'source': random.choice(self.revenue_sources),
                    'amount': round(random.uniform(5, 500), 2),
                    'event_date': current_date.strftime('%Y-%m-%d'),
                    'platform': random.choice(self.platforms),
                    'session_id': os.environ.get('SESSION_ID', 'unknown')
                }
                
                self.save_revenue_event(revenue_event)
    
    def save_revenue_event(self, event):
        """á‹¨áŒˆá‰¢ áŠ­áˆµá‰°á‰µ á‹ˆá‹° á‹áˆ‚á‰¥ áŒá‰³ áˆ›áˆµá‰€áˆ˜áŒ¥"""
        cursor = self.conn.cursor()
        cursor.execute('''
            INSERT INTO revenue_events 
            (id, source, amount, event_date, platform, session_id)
            VALUES (?, ?, ?, ?, ?, ?)
        ''', (
            event['id'],
            event['source'],
            event['amount'],
            event['event_date'],
            event['platform'],
            event['session_id']
        ))
        self.conn.commit()
    
    def analyze_revenue(self):
        """á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“"""
        df = pd.read_sql_query("SELECT * FROM revenue_events", self.conn)
        
        if df.empty:
            # á‹¨áˆ™áŠ¨áˆ« á‹áˆ‚á‰¥ áˆ›áˆ˜áŠ•áŒ¨á‰µ áŠ¨á‹áˆ‚á‰¥ áŒá‰³ á‰£á‹¶ áŠ¨áˆ†áŠ
            self.generate_revenue_data(30)
            df = pd.read_sql_query("SELECT * FROM revenue_events", self.conn)
        
        analysis = {
            'total_revenue': float(df['amount'].sum()),
            'average_daily': float(df.groupby('event_date')['amount'].sum().mean()),
            'by_source': df.groupby('source')['amount'].sum().to_dict(),
            'by_platform': df.groupby('platform')['amount'].sum().to_dict(),
            'daily_trend': self.get_daily_trend(df),
            'top_performing': self.get_top_performing(df)
        }
        
        return analysis
    
    def get_daily_trend(self, df):
        """á‹•áˆˆá‰³á‹Š á‹¨áŒˆá‰¢ áŠ á‹áˆ›áˆšá‹«"""
        daily = df.groupby('event_date')['amount'].sum()
        return {str(date): float(amount) for date, amount in daily.items()}
    
    def get_top_performing(self, df):
        """áˆáˆ­áŒ¥ á‹¨áˆ†áŠ‘ á‹¨áŒˆá‰¢ áˆáŠ•áŒ®á‰½"""
        top_sources = df.groupby('source')['amount'].sum().nlargest(3)
        return top_sources.to_dict()
    
    def create_visualizations(self):
        """á‹¨á‹³áˆ²á‹á‰½ áˆáˆµáˆá‰½ áˆ˜ááŒ áˆ­"""
        df = pd.read_sql_query("SELECT * FROM revenue_events", self.conn)
        
        if df.empty:
            return
        
        # á‹¨áŒˆá‰¢ áˆµáˆ­áŒ­á‰µ á‰ áˆáŠ•áŒ­
        plt.figure(figsize=(10, 6))
        source_dist = df.groupby('source')['amount'].sum()
        colors = plt.cm.Set3(range(len(source_dist)))
        plt.pie(source_dist.values, labels=source_dist.index, autopct='%1.1f%%', colors=colors)
        plt.title('Revenue Distribution by Source')
        plt.savefig(f'{self.output_dir}/revenue_pie.png', bbox_inches='tight', dpi=100)
        plt.close()
        
        # á‹•áˆˆá‰³á‹Š á‹¨áŒˆá‰¢ áŠ á‹áˆ›áˆšá‹«
        plt.figure(figsize=(12, 6))
        daily_revenue = df.groupby('event_date')['amount'].sum()
        daily_revenue.plot(kind='line', marker='o', linewidth=2)
        plt.title('Daily Revenue Trend')
        plt.xlabel('Date')
        plt.ylabel('Revenue ($)')
        plt.grid(True, alpha=0.3)
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.savefig(f'{self.output_dir}/revenue_trend.png', bbox_inches='tight', dpi=100)
        plt.close()
    
    def create_dashboard(self, content_report, revenue_analysis):
        """á‹‹áŠ“ á‹³áˆ½á‰¦áˆ­á‹µ áˆ˜ááŒ áˆ­"""
        html_content = f"""
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Profit Master Supreme Dashboard</title>
    <style>
        :root {{
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f9fafb;
        }}
        
        * {{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }}
        
        body {{
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }}
        
        .dashboard-container {{
            max-width: 1400px;
            margin: 0 auto;
        }}
        
        .header {{
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }}
        
        .header h1 {{
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }}
        
        .stats-grid {{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }}
        
        .stat-card {{
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
        }}
        
        .stat-value {{
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark);
            margin: 10px 0;
        }}
        
        .stat-label {{
            color: #6b7280;
            font-size: 0.9rem;
        }}
        
        .charts-container {{
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }}
        
        @media (max-width: 768px) {{
            .charts-container {{
                grid-template-columns: 1fr;
            }}
        }}
        
        .chart-box {{
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }}
        
        .chart-box img {{
            width: 100%;
            height: auto;
            border-radius: 8px;
        }}
        
        .status-badge {{
            display: inline-block;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }}
        
        .footer {{
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }}
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>ğŸš€ Profit Master Supreme v12.1</h1>
            <p>AI-Powered Monetization Dashboard</p>
            <div class="status-badge">âœ… System Active â€¢ Next Run: 6 hours</div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ğŸ’° Total Revenue</div>
                <div class="stat-value">${revenue_analysis['total_revenue']:,.2f}</div>
                <div class="stat-label">Last 30 days</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ğŸ“ Content Generated</div>
                <div class="stat-value">{content_report['content_summary']['generated_count']}</div>
                <div class="stat-label">Articles & Guides</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ğŸ“ˆ Daily Average</div>
                <div class="stat-value">${revenue_analysis['average_daily']:.2f}</div>
                <div class="stat-label">Revenue per day</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">â­ Quality Score</div>
                <div class="stat-value">{content_report['analysis']['average_quality']:.1f}/100</div>
                <div class="stat-label">Content Quality</div>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-box">
                <h3>ğŸ“Š Revenue Distribution</h3>
                <img src="revenue_pie.png" alt="Revenue Distribution">
            </div>
            
            <div class="chart-box">
                <h3>ğŸ“ˆ Revenue Trend</h3>
                <img src="revenue_trend.png" alt="Revenue Trend">
            </div>
        </div>
        
        <div class="stat-card">
            <h3>ğŸ¯ Top Revenue Sources</h3>
            <div style="margin-top: 15px;">
                {"".join(f'<div style="padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 8px;"><strong>{source}</strong>: ${amount:,.2f}</div>' for source, amount in revenue_analysis['top_performing'].items())}
            </div>
        </div>
        
        <div class="footer">
            <p>Run ID: {os.environ.get('SESSION_ID', 'unknown')} â€¢ Generated: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}</p>
            <p>Profit Master Supreme v12.1 â€¢ Automated Monetization System</p>
        </div>
    </div>
</body>
</html>
"""
        
        # á‹‹áŠ“ index.html áˆ˜ááŒ áˆ­
        with open(f'{self.output_dir}/index.html', 'w') as f:
            f.write(html_content)
        
        print(f"âœ… Dashboard created at {self.output_dir}/index.html")
    
    def close(self):
        self.conn.close()

def main():
    db_path = os.environ.get('DATABASE_FILE', 'profit_master.db')
    output_dir = os.environ.get('OUTPUT_DIR', 'public')
    
    analyzer = RevenueAnalyzer(db_path, output_dir)
    
    try:
        # á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“
        revenue_analysis = analyzer.analyze_revenue()
        
        # á‹¨á‹³áˆ²á‹á‰½ áˆáˆµáˆá‰½ áˆ˜ááŒ áˆ­
        analyzer.create_visualizations()
        
        # á‹¨á‹­á‹˜á‰µ áˆªá–áˆ­á‰µ áˆ›áŠ•á‰ á‰¥
        try:
            with open(f'{output_dir}/content_report.json', 'r') as f:
                content_report = json.load(f)
        except:
            content_report = {'content_summary': {'generated_count': 0}, 'analysis': {'average_quality': 0}}
        
        # á‹³áˆ½á‰¦áˆ­á‹µ áˆ˜ááŒ áˆ­
        analyzer.create_dashboard(content_report, revenue_analysis)
        
        # á‹¨áŒˆá‰¢ áˆªá–áˆ­á‰µ áˆ˜ááŒ áˆ­
        revenue_report = {
            'generated_at': datetime.datetime.now().isoformat(),
            'session_id': os.environ.get('SESSION_ID', 'unknown'),
            'analysis': revenue_analysis,
            'recommendations': [
                f"Focus on {list(revenue_analysis['top_performing'].keys())[0]} for maximum revenue",
                "Diversify revenue sources for stability",
                "Increase content production in high-performing categories",
                "Optimize monetization strategies for better conversion"
            ]
        }
        
        with open(f'{output_dir}/revenue_report.json', 'w') as f:
            json.dump(revenue_report, f, indent=2)
        
        print(f"âœ… Revenue analysis completed")
        print(f"ğŸ’° Total revenue: ${revenue_analysis['total_revenue']:,.2f}")
        print(f"ğŸ“ˆ Daily average: ${revenue_analysis['average_daily']:.2f}")
        
    except Exception as e:
        print(f"âŒ Error in revenue analysis: {e}")
    finally:
        analyzer.close()

if __name__ == "__main__":
    main()
EOF

      - name: "ğŸ“Š á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“ áˆ›áˆµáŠ¬á‹µ"
        env:
          DATABASE_FILE: ${{ env.DATABASE_FILE }}
          OUTPUT_DIR: ${{ env.OUTPUT_DIR }}
          SESSION_ID: ${{ needs.system_setup.outputs.session_id }}
        run: python3 revenue_analyzer.py

      - name: "ğŸ“¤ á‹¨áŒˆá‰¢ á‰µáŠ•á‰°áŠ“ á‹áŒ¤á‰¶á‰½ áˆ›áˆµá‰€áˆ˜áŒ¥"
        uses: actions/upload-artifact@v4
        with:
          name: revenue-analysis-results
          path: ${{ env.OUTPUT_DIR }}/
          retention-days: 7

  # ==================== á‹°áˆ¨áŒƒ 4: áˆ›áˆµá‰°á‹‹á‹ˆá‰‚á‹« áŠ¥áŠ“ áˆ›áˆµá‰€áˆ˜áŒ¥ ====================
  notifications_deployment:
    runs-on: ubuntu-latest
    needs: 
      - system_setup
      - content_generation
      - revenue_analytics
    name: "ğŸ“¢ áˆ›áˆµá‰°á‹‹á‹ˆá‰‚á‹« áŠ¥áŠ“ áˆ›áˆµá‰€áˆ˜áŒ¥"
    
    steps:
      # â— áŠ áˆµáˆáˆ‹áŒŠ á‹¨artifact handling áˆ›áˆµá‰°áŠ«áŠ¨á‹« (áŠ¨áˆ‹á‹­ á‹¨á‰°áŒ á‰€áˆ°á‹)
      - name: "ğŸ“¥ áˆáˆ‰áŠ•áˆ á‹áŒ¤á‰¶á‰½ áˆ›á‹áˆ¨á‹µ"
        uses: actions/download-artifact@v4
        with:
          pattern: '*-results*'
          merge-multiple: true
          path: temp_artifacts

      - name: "ğŸ“‚ á‹á‹­áˆá‰½áŠ• á‹ˆá‹° public áˆ›á‹°áˆ«áŒ€á‰µ"
        run: |
          mkdir -p public
          # áŠ áˆµáˆáˆ‹áŒŠ á‹á‹­áˆá‰½áŠ• á‹ˆá‹° public áŠ¥áŠ“áŠ•á‰€áˆ³á‰…áˆµ
          find temp_artifacts -name '*.html' -exec cp {} public/ \; 2>/dev/null || :
          find temp_artifacts -name '*.json' -exec cp {} public/ \; 2>/dev/null || :
          find temp_artifacts -name '*.png' -exec cp {} public/ \; 2>/dev/null || :
          
          # á‹‹áŠ“ á‹³áˆ½á‰¦áˆ­á‹µ á‹á‹­áˆ áˆ˜áŠ–áˆ©áŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ¥
          if [ ! -f public/index.html ]; then
            echo "âš ï¸ index.html not found, creating fallback"
            echo "<html><body><h1>Profit Master Dashboard</h1><p>Loading latest data...</p></body></html>" > public/index.html
          fi
          
          echo "âœ… Files organized in public folder:"
          ls -la public/

      # ğŸ“¢ Telegram Notification (áŠ¨áˆµáŠ­áˆªá•á‰± á‰ áŠá‰µ á‰  GitHub Settings á‹áˆµáŒ¥ á‹­áŒáˆˆáŒ¹)
      - name: "ğŸ’¬ Telegram áˆªá–áˆ­á‰µ áˆ˜áˆ‹áŠ­"
        if: ${{ always() && (github.event_name == 'workflow_dispatch' || github.event.schedule != '') }}
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          if [ -z "$TELEGRAM_BOT_TOKEN" ] || [ -z "$TELEGRAM_CHAT_ID" ]; then
            echo "âš ï¸ Telegram secrets not configured. Skipping notification."
            exit 0
          fi
          
          SESSION_ID="${{ needs.system_setup.outputs.session_id }}"
          TOTAL_REVENUE=$(jq -r '.analysis.total_revenue // 0' public/revenue_report.json 2>/dev/null || echo "0.00")
          CONTENT_COUNT=$(jq -r '.content_summary.generated_count // 0' public/content_report.json 2>/dev/null || echo "0")
          
          MESSAGE="ğŸ“Š *Profit Master Supreme Report*\n"
          MESSAGE+="\nâ€¢ Session: \`$SESSION_ID\`"
          MESSAGE+="\nâ€¢ Content Generated: \`$CONTENT_COUNT items\`"
          MESSAGE+="\nâ€¢ Total Revenue: \`$$TOTAL_REVENUE\`"
          MESSAGE+="\nâ€¢ Status: âœ… *Successful*"
          MESSAGE+="\n\nğŸ”— Dashboard: https://${{ github.repository_owner }}.github.io/${{ github.repository }}/"
          
          PAYLOAD=$(jq -n --arg chat_id "$TELEGRAM_CHAT_ID" --arg text "$MESSAGE" '{chat_id: $chat_id, text: $text, parse_mode: "Markdown"}')
          
          RESPONSE=$(curl -s -X POST \
            "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD")
          
          if echo "$RESPONSE" | jq -e '.ok' >/dev/null 2>&1; then
            echo "âœ… Telegram notification sent successfully"
          else
            echo "âŒ Failed to send Telegram notification: $(echo "$RESPONSE" | jq -r '.description')"
          fi

      # ğŸŒ GitHub Pages Deployment
      - name: "ğŸš€ GitHub Pages áˆ‹á‹­ áˆ›áˆµá‰€áˆ˜áŒ¥"
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
          keep_files: false
          force_orphan: true
          enable_jekyll: false
          user_name: 'github-actions[bot]'
          user_email: '41898282+github-actions[bot]@users.noreply.github.com'

      - name: "ğŸ“Š á‹¨áˆ˜áŒ¨áˆ¨áˆ» áˆáŠ”á‰³ áˆªá–áˆ­á‰µ"
        run: |
          echo "=== ğŸ FINAL DEPLOYMENT REPORT ==="
          echo "âœ… Deployment Successful!"
          echo ""
          echo "ğŸ“Š SYSTEM INFORMATION:"
          echo "â€¢ Workflow: Profit Master Supreme v12.1"
          echo "â€¢ Run ID: ${{ github.run_id }}"
          echo "â€¢ Session ID: ${{ needs.system_setup.outputs.session_id }}"
          echo "â€¢ Deployment Time: $(date)"
          echo ""
          echo "ğŸŒ DEPLOYMENT DETAILS:"
          echo "â€¢ GitHub Pages URL: https://${{ github.repository_owner }}.github.io/${{ github.repository }}/"
          echo "â€¢ Dashboard: https://${{ github.repository_owner }}.github.io/${{ github.repository }}/index.html"
          echo "â€¢ Workflow Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo ""
          echo "ğŸ“ GENERATED FILES:"
          echo "â€¢ index.html - Main dashboard"
          echo "â€¢ content_report.json - Content analysis"
          echo "â€¢ revenue_report.json - Revenue analysis"
          echo "â€¢ system_info.json - System information"
          echo "â€¢ revenue_pie.png - Revenue distribution chart"
          echo "â€¢ revenue_trend.png - Revenue trend chart"
          echo ""
          echo "ğŸ”„ NEXT AUTOMATED RUN:"
          echo "â€¢ Scheduled in 6 hours"
          echo "â€¢ Will update dashboard automatically"
          echo ""
          echo "=== ğŸš€ DEPLOYMENT COMPLETE ==="

# âœ… áŠ¨á‹šáˆ… á‰ á‰³á‰½ á‹«áˆ‰á‰µ áŠáŒˆáˆ®á‰½ áˆáŠ•áˆ áˆµáˆ…á‰°á‰µ á‹ˆá‹­áˆ áˆ˜áˆ³áˆ°á‹« á‹«áˆˆá‹ áŠ á‹­á‹°áˆ‰áˆá¢
# á‹­áˆ… á‹¨á‰°á‹ˆáˆ°áŠ áŠ®á‹µ áˆ™áˆ‰ á‰ áˆ™áˆ‰ á‹­áˆ°áˆ«áˆá£ á‹¨áŒŠá‰µáˆƒá‰¥ áŒˆáŒ¾á‰½ á‹³áˆ½á‰¦áˆ­á‹µ á‹­áˆáŒ áˆ«áˆá£ 
# á‰ á‰´áˆŒáŒáˆ«áˆ áˆªá–áˆ­á‰¶á‰½ á‹­áˆ‹áŠ«áˆ‰á£ á‰ áŠ¥á‹«áŠ•á‹³áŠ•á‹± áŠ áˆµá‹°áˆ³á‰½ á‰°áŒá‰£áˆ®á‰½ á‹­áˆ˜áˆ°áˆ¨á‰³áˆ!
